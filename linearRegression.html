<!DOCTYPE html>
<html>
<head>
    <title>CS 3300 Project 2 </title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    
    <link rel = "stylesheet" type="text/css" href = "linRegress.css">
</head>
    
<body>

    
<div class = "regression">

    
    <div id='plotCountries'></div>
    
    <script>
        
        // Create svg group for each sport
        
        
        var longJump_svg = d3.select('.regression').append("svg")
        .attr("width", 1400).attr("height", 50);
        var hammerThrow_svg = d3.select('.regression').append("svg")
        .attr("width", 1400).attr("height", 50);
        var freestyle_svg = d3.select('.regression').append("svg")
        .attr("width", 1400).attr("height", 50);
        var hurdles_svg = d3.select('.regression').append("svg")
        .attr("width", 1400).attr("height", 50);
        var shotPut_svg = d3.select('.regression').append("svg")
        .attr("width", 1400).attr("height", 50);
        var tripleJump_svg = d3.select('.regression').append("svg")
        .attr("width", 1400).attr("height", 50);
        var track_svg = d3.select('.regression').append("svg")
        .attr("width", 1400).attr("height", 50);
        var butterfly_svg = d3.select('.regression').append("svg")
        .attr("width", 1400).attr("height", 50);
        var discusThrow_svg = d3.select('.regression').append("svg")
        .attr("width", 1400).attr("height", 50);
        var highJump_svg = d3.select('.regression').append("svg")
        .attr("width", 1400).attr("height", 50);
        
        var yearScale = d3.scaleLinear().domain([1890,2016]).range([200,1000]);
        
        var olympicYears = [];
        for (i = 1896; i < 2017; i = i + 4) {
            olympicYears.push(i)
        }
        

        // Append country flags
        function plotRegression(data, svgGroup) {
            
            var sportData = [];
            
            var yearData = [];
            
            var counter = 0;
            
            for (year in data) {
                
                if (data[year].game == "200m Butterfly Mens" || data[year].game == "200m Butterfly Womens" || data[year].game == "400m Freestyle Mens" || data[year].game == "400m Freestyle Womens") {
                    
                var result= data[year].result;
                    
                var seconds = Number(result.substr(0,1))*60 + Number(result.substr(2,3))
                    
                sportData.push(seconds)
                }
                
                else { sportData.push(Number(data[year].result))}
                
                
                yearData.push(Number(year));
                
            }
            
            var min = d3.min(sportData);
            var max = d3.max(sportData);
            console.log(min,max)
            
            var resultScale = d3.scaleLinear().domain([min,max]).range([50,0]);
        
    
            
            // Append the country names
            var sportName = svgGroup.append('text').text(data["2016"].game)
                    .attr('class', 'hover-sport')
                    .attr('x', 60)
                    .attr('y', 25);
            
            // Append the years
            for (y in olympicYears) {
                    var sportYears = svgGroup.selectAll("g").data(olympicYears)
                        .enter().append("rect")
                        .attr("class", "dataPoints")
                        .attr('x', function(d) {return yearScale(d)})
                        .attr('y', 20)
                        .attr('width', '10px')
                        .attr('height', '10px')
                        .attr('fill', function(d) {
                        
                            // If country won an award that year
                            if (yearData.includes(d)) {
                                return "#8B8EFE";
                            } else {
                                return "lightGrey";
                            }
                            
                        });
        
                
            svgGroup.on('mouseenter', function(d) {
                            resultScale.range([120,20])
                            
                            svgGroup.selectAll(".dataPoints")
            	           .attr("height", function(d,i){
                                if (yearData.includes(d)){
                                    var ind = yearData.indexOf(d);
                                    return(120-resultScale(sportData[ind]))
                                }
                            })
                            .transition()
            
                            .attr("y", function(d,i){
                                if (yearData.includes(d)){
                                    var ind = yearData.indexOf(d);
                                    return(resultScale(sportData[ind]))
                                }

                            });
                
                            svgGroup.attr("height", 150);
                

                    var yAxis = d3.axisLeft(resultScale)
                    .ticks(6)
                    .tickSize(0);

                    var axisGroup = svgGroup.append("g").call(yAxis)
                    .transition()
                    .attr("class", "axis")
                    .style("font-size", 10)
                    .attr("transform", "translate(220,0)") 

                     svgGroup.append("text").text("Gun Ownership %")
                    .attr("x", -300)
                    .attr("y", -50)
                    .attr("transform", "rotate(270)")
                    .style("text-anchor", "middle");
                            
                        });
                
                
                svgGroup.on('mouseleave', function(d) {
                            resultScale.range([50,0])
                            
                            svgGroup.selectAll(".dataPoints")
            	           .attr("height", 10)
                            .transition()
                            .attr("y", 20);
                
                            svgGroup.attr("height", 50);
                    
                            svgGroup.select(".axis").remove();
                    
                
                            
                        });
                        
                    
                // Hover over the years
                // yrs.on('mouseenter', function(d) {
                    // console.log('mouseeenter');
                    // console.log(d);
                    
                    // d3.select('#'+c+'squares').style('display', 'inline');
                //});
                    
                }
                counter += 1;
            
            }
            
            // On hover
//            d3.selectAll(countryGroup)
//                .on('click', function(d) {
//                console.log('hover');
//            })
        
        
        
    </script>
    
    </div>
    
    
    
    <div id="linPlot">
        
        <script>
        // Olympic Sports of interest
        var longJumpM = {};     // Long Jump
        var longJumpW = {};
        var hammerM = {};       // Hammer Throw
        var hammerW = {};   
        var freestyleM = {};    // 400m Free Style
        var freestyleW = {};
        var hurdlesM = {};      // Hurdles
        var hurdlesW = {}; 
        var shotPutM = {};      // Shot Put
        var shotPutW = {};
        var tripleJumpM = {};   // Triple Jump
        var tripleJumpW = {};
        var trackM = {};        // 100m Track
        var trackW = {};
        var butterflyM = {};    // 200m Butterfly
        var butterflyW = {};
        var discusM = {};       // Discus Throw
        var discusW = {};
        var highJumpM = {};     // High Jump
        var highJumpW = {};
        
        
        function parseLine(line) {
                return {
                    game: line["Game"],
                    year: line["Year"],
                    medal: line["Medal"],
                    result: (line["Result"]),
                    country: line["Country"],
                    athlete: line["Athlete"]
                }
        }
        
        
         // Update the data object olympicResults to include new results
        function olympicYearResults (olympicResults, d){
            olympicResults[d.year] = {result: d.result, athlete: d.athlete, country: d.country, game: d.game};
        };
        
            
        d3.csv("OlympicRegression.csv", parseLine, function(error,data){
                
            olympicData = data;

            // Create object for each olympic game (key = year)
            olympicData.forEach(function(d){

                if (d.game == "Long Jump Mens"){ olympicYearResults(longJumpM, d); }

                else if (d.game == "Long Jump Womens"){ olympicYearResults(longJumpW, d); }
                
                else if (d.game == "Hammer Throw Mens"){ olympicYearResults(hammerM, d); }
                
                 else if (d.game == "Hammer Throw Womens"){ olympicYearResults(hammerW, d); }
                
                else if (d.game == "400m Freestyle Mens"){ olympicYearResults(freestyleM, d); }
                
                else if (d.game == "400m Freestyle Womens"){ olympicYearResults(freestyleW, d); }
                
                else if (d.game == "Hurdles Mens"){ olympicYearResults(hurdlesM, d); }
                
                else if (d.game == "Hurdles Womens"){ olympicYearResults(hurdlesW, d); }
                
                else if (d.game == "Shot Put Mens"){ olympicYearResults(shotPutM, d); }
                
                else if (d.game == "Shot Put Womens"){ olympicYearResults(shotPutW, d); }
                
                else if (d.game == "Triple Jump Mens"){ olympicYearResults(tripleJumpM, d); }
                
                else if (d.game == "Triple Jump Womens"){ olympicYearResults(tripleJumpW, d); }
                
                else if (d.game == "100m Mens"){ olympicYearResults(trackM, d); }
                
                else if (d.game == "100m Womens"){ olympicYearResults(trackW, d); }
                
                else if (d.game == "200m Butterfly Mens"){ olympicYearResults(butterflyM, d); }
                
                else if (d.game == "200m Butterfly Womens"){ olympicYearResults(butterflyW, d); }
                
                else if (d.game == "Discus Throw Mens"){ olympicYearResults(discusM, d); }
                
                else if (d.game == "Discus Throw Womens"){ olympicYearResults(discusW, d); }
                
                else if (d.game == "High Jump Mens"){ olympicYearResults(highJumpM, d); }
                
                else if (d.game == "High Jump Womens"){ olympicYearResults(highJumpW, d); }
            
                
            })
            
            var olympicSports = [longJumpM, longJumpW, hammerM, hammerW, freestyleM,freestyleW,hurdlesM, hurdlesW, shotPutM, shotPutW,tripleJumpM, tripleJumpW, trackM, trackW, butterflyM, butterflyW, discusM, discusW, highJumpM, highJumpW];
            
            
            plotRegression(longJumpM,longJump_svg);
            plotRegression(hammerM, hammerThrow_svg);
            plotRegression(freestyleM,freestyle_svg);
            plotRegression(hurdlesM,hurdles_svg);
            plotRegression(shotPutM,shotPut_svg);
            plotRegression(tripleJumpM, tripleJump_svg);
            plotRegression(trackM, track_svg);
            plotRegression(butterflyM, butterfly_svg);
            plotRegression(discusM,discusThrow_svg);
            plotRegression(highJumpM, highJump_svg);
            
            
            plotLinearRegression(longJumpM,longJumpW);
            plotLinearRegression(hammerM,hammerW);
            plotLinearRegression(freestyleM,freestyleW);
            plotLinearRegression(hurdlesM,hurdlesW);
            plotLinearRegression(shotPutM,shotPutW);
            plotLinearRegression(tripleJumpM,tripleJumpW);
            plotLinearRegression(trackM,trackW);
            plotLinearRegression(butterflyM,butterflyW);
            plotLinearRegression(discusM,discusW);
            plotLinearRegression(highJumpM,highJumpW);
            
            console.log(longJumpM);
           
            

            // Call Back Function region ----------------------------------------
        });
    
    </script>
    
    
    <script>
        
        var width = 1200, height = 50;
        
        
         function leastSquares(xData,yData) {
            var model = { intercept: 0, slope: 0 };

            if (xData.length == 0) { return model; }

            var meanX = d3.mean(xData);

            var meanY = d3.mean(yData);

            model.slope = d3.sum(xData, function (d,i) {
                return (xData[i] - meanX) * (yData[i] - meanY);
            });

            model.slope /= d3.sum(xData, function (d,i) {
                return (xData[i] - meanX) * (xData[i] - meanY);
            });

            model.intercept = meanY - model.slope * meanX;
            return model;
        }
        
        
        
        
        var yearScale = d3.scaleLinear().domain([1890,2016]).range([200,1000]);
        
        var svg = d3.select(".info-container")
            .append("svg")
            .attr("width", width)
            .attr("height", 100);
        
        var xAxis = d3.axisTop().scale(yearScale);
        svg.append("g").call(xAxis).attr("transform", "translate(0,100)");
        
        
        
        
        function getPoints(data) {
            yearData = [];
            resultData = [];
            
            for (year in data) {
                
                if (data[year].game == "200m Butterfly Mens" || data[year].game == "200m Butterfly Womens" || data[year].game == "400m Freestyle Mens" || data[year].game == "400m Freestyle Womens") {
                    
                    var result= data[year].result;
                    
                    var seconds = Number(result.substr(0,1))*60 + Number(result.substr(2,3))
                    
                    resultData.push(seconds)
                }
                
                else { resultData.push(Number(data[year].result))}
                
                yearData.push(Number(year));
                
            }
            
            return [yearData, resultData];
        }
        
        function plotLine(resultData, yearData, svgGroup, resultScale, color){
            
            var line = d3.line()
            .x(function(d,i) {return yearScale(yearData[i])})
            .y(function(d) {return resultScale(d)});
            
            svgGroup.append("path")
            .datum(resultData)
            .attr("stroke-width", 2)
            .attr("stroke", color)
            .attr("fill", "none")
            .attr("d",line);

            
        }
        
        function plotLinearRegression(dataM, dataW) {
            
            // Create SVG
            var svg = d3.select("#linPlot")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .style("background-color", "#F8F9F9");
            
            var svgGroup = svg.append("g");
            
            var text = dataM[2016].game;
            var gameText  = text.substr(0, text.length - 5)
            
            svgGroup.append("text").text(gameText).attr("x", 50).attr("y",30);
            
            var pointDataM = getPoints(dataM);

            var pointDataW = getPoints(dataW);
            
            var minM = d3.min(pointDataM[1]);
            var maxM = d3.max(pointDataM[1]);
            var minW = d3.min(pointDataW[1]);
            var maxW = d3.max(pointDataW[1]);
            
            var min = d3.min([minM, minW]);
            var max = d3.max([maxM,maxW]);
            

            var resultScale = d3.scaleLinear().domain([min,max]).range([45,5]);
            
            console.log(pointDataM);
            
            plotLine(pointDataM[1], pointDataM[0], svgGroup, resultScale, "#8B8EFE");
            plotLine(pointDataW[1], pointDataW[0], svgGroup, resultScale, "#70EAAF");
            
            
            
            
        }
    

    </script>
    </div>
    
</div>

</body>
    
</html>