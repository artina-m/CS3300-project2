<!DOCTYPE html>
<html>
<head>
    <title>INFO 3300 Project 2 </title>
    <meta name="description" content="INFO 3300 Project 2">
    <meta charset="utf-8">
    
    <!-- Load d3, topojson & AJAX -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="http://d3js.org/topojson.v2.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script><script src="https://d3js.org/d3.v4.min.js"></script>
    
    <link rel = "stylesheet" type="text/css" href = "style.css">
    
    <!-- Font -->
        <!--    extra-light 200
                light 300
                regular 400
                semi-bold 600
                bold 700
                extra-bold 800
                black 900-->
    <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
</head>

<body>
    <div>
    <p>     
        <script>
            // Olympic Games of interest
            var mens100m  = {}; // result (time), athlete, country, speed
            var womens100m  = {};
            
            // Olympic Games by country
            // key: country
            // data: # medals, # gold, # silver, # bronze
            // data: [year: # medals, # gold, # bronze]
            var countryData = {};
            
            function parseLine(line) {
                return {
                    game: line["Game"],
                    year: line["Year"],
                    medal: line["Medal"],
                    result: Number(line["Result"]),
                    country: line["Country"],
                    athlete: line["Athlete"]
                }
            }
            
            // Create objects for gold, silver, and bronze results.
            // Update the data object olympicResults to include new results
            function olympicYearResults (olympicResults, d){
                var game = (d.game).replace(/\s/g, '').toLowerCase();
                if (d.medal == "gold"){
                    olympicResults[d.year].gold = {game: game, result: d.result, athlete: d.athlete, country: d.country};
                }
                if (d.medal == "silver"){
                    olympicResults[d.year].silver = {game: game, result: d.result, athlete: d.athlete, country: d.country};
                }
                if (d.medal == "bronze"){
                    olympicResults[d.year].bronze = {game: game, result: d.result, athlete: d.athlete, country: d.country};
                }
            }    
            
            d3.csv("olympicData.csv", parseLine, function(error,data){
                olympicData = data;
                
                // Create object for each olympic game (key = year)
                olympicData.forEach(function(d){
                    
                    if (d.game == "100M Men") { 
                        mens100m[d.year]= {} 
                    } else if (d.game == "100M Women") { 
                        womens100m[d.year] = {} 
                    }
                    
                    // Populate countryData
                    
                    // If countryData already has that country 
                    if (countryData[d.country]) {
                        if (d.medal == 'gold') {
                            countryData[d.country].total += 1;
                            countryData[d.country].gold += 1;
                            if (countryData[d.country].byyear[d.year]) {
                                countryData[d.country].byyear[d.year].t +=1;
                                countryData[d.country].byyear[d.year].g +=1;
                            } else {
                                countryData[d.country].byyear[d.year] = {t:1, g:1, s:0, b:0};
                            }
                        } else if (d.medal == 'silver') {
                            countryData[d.country].total += 1;
                            countryData[d.country].silver += 1;
                            if (countryData[d.country].byyear[d.year]) {
                                countryData[d.country].byyear[d.year].t +=1;
                                countryData[d.country].byyear[d.year].s +=1;
                            } else {
                                countryData[d.country].byyear[d.year] = {t:1, g:0, s:1, b:0};
                            }
                        } else {
                            countryData[d.country].total += 1;
                            countryData[d.country].bronze += 1;
                            if (countryData[d.country].byyear[d.year]) {
                                countryData[d.country].byyear[d.year].t +=1;
                                countryData[d.country].byyear[d.year].b +=1;
                            } else {
                                countryData[d.country].byyear[d.year] = {t:1, g:0, s:0, b:1};
                            }
                        }
                    } else {
                        countryData[d.country] = {total: 0, gold: 0, silver: 0, bronze: 0, byyear:{}};
                    }
                })
                
                // Create object for every year's results (keys =  gold, silver and bronze )
                olympicData.forEach(function(d){
                    
                    if (d.game == "100M Men"){ 
                        olympicYearResults(mens100m, d); 
                    } else if (d.game == "100M Women") { 
                        olympicYearResults(womens100m, d); 
                    }
                    
                });
                
                // Add speeds to object: 100m / result
                for (year in mens100m){
                    mens100m[year].gold.speed = 100.0/mens100m[year].gold.result;
                    mens100m[year].silver.speed = 100.0/mens100m[year].silver.result;
                    mens100m[year].bronze.speed = 100.0/mens100m[year].bronze.result;
                };
                                
                plotTracks(mens100m);
                plotCountries(countryData);
                
                createPlot(mens100m, 0);
                
                d3.select("#dataSlider").on("input", function() {
                updatePlot(+this.value);
        });
                
                //createPlot(mens100m,2);
            });
                        
        </script>
    </p>
        
    <p id = "trackViz">

        <script>
            
            var width = 1400, height = 600;

            var xScale = d3.scaleLinear().domain([0,100]).range([100,1000]);

            var xScale2 = d3.scaleLinear().domain([80,100]).range([100,1000]); // zoom into points

            var yScale = d3.scaleLinear().domain([0,25]).range([490,90]);

            // Create SVG
            var svg = d3.select("#trackViz")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

            var svgGroup = svg.append("g");
            
            // Initialize 100M Men's Record
            var recordTime = 9.63; 
            var recordSpeed = 100/9.63;
            
            // Initialize 100M Men's variables
            var plottingData  = [];
            var countries = [];
            var circles;
            
            // Plots 100M Men's Record
            function plotTracks(data) {
    
                n = 1;
                
                for (y in data) {
                    
                    var goldDistance = data[y].gold.speed*recordTime;
                    
                    plottingData.push({game: data[y].gold.game, start: 0, end: goldDistance, speed:data[y].gold.speed, result: data[y].gold.speed.result, color: "gold", order: n, year: y, medal: "gold", athlete: data[y].gold.athlete, country: data[y].gold.country });
                            
                    var silverDistance = data[y].silver.speed*recordTime;
                    
                    plottingData.push({game: data[y].silver.game, start: 0, end: silverDistance, speed:data[y].silver.speed, result: data[y].silver.result, color: "grey", order: n, year: y, medal: "silver", athlete: data[y].silver.athlete, country: data[y].silver.country});
                    
                    var bronzeDistance = data[y].bronze.speed*recordTime;
                    
                    plottingData.push({game: data[y].bronze.game, start: 0, end: bronzeDistance,speed:data[y].bronze.speed, result: data[y].bronze.result, color: "orange", order:n, year: y, medal: "bronze", athlete: data[y].bronze.athlete, country: data[y].bronze.country});
                    
                    n++;
                }
                            
                // Add track for each olympic year
                var raceTrack = svgGroup.selectAll("g").data(plottingData).enter().append("rect");

                raceTrack.attr("width", 900).attr("height",14 )
                .attr("x",100).attr("y", function(d) {return(yScale(d.order) - 7)})
                .style("fill", "lightGrey")
                .style("opacity", .1);

                // Finish Line
                svgGroup.append("rect")
                .attr("x", xScale(100))
                .attr("y", yScale(25))
                .attr("width", 50)
                .attr("height", 400)
                .style("fill", "white")
                .style("stroke", "grey")
                .style("stroke-width", .5);

                svgGroup.append("text").text("FINISH")
                .attr("x", -300)
                .attr("y", 1035)
                .attr("transform", "rotate(270)")
                .style("text-anchor", "middle")
                .style("font-size", 25)
                // .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");

                // Add gold, bronze, and silver medal plots
                circles = svgGroup.selectAll("g").data(plottingData)
                .enter().append("circle");

                circles.attr("cx", function(d) {return xScale(d.start)})
                .attr("cy",function(d) {return yScale(d.order)})
                .attr("r", 5)
                .style("fill", function(d) {return d.color});

                circles.transition()
                 .duration(2000)
                    .attr('cx', function(d,i) { return xScale(d.end) })
                .transition()
                 .duration(5000)
                    .attr('cx', function(d,i) { return xScale2(d.end) });


                // Add y-axis text: years
                var olympicYears = svg.selectAll("g").data(plottingData).enter().append("text");

                olympicYears.text(function(d) {return d.year})
                .attr("x", 50)
                .attr("y", function(d) {return yScale(d.order)})
                .style("alignment-baseline", "middle")
                .style("font-size", 12)
                // .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");


                // Add titles
                svg.append("text").text("Olympic 100M Mens")
                .attr("x", xScale(0))
                .attr("y", 45)
                .style("font-size", 25)
                // .style("font-family", "Roboto")
                .style("font-weight", 600);

                svg.append("text").text("If all Olympians raced the same race")
                .attr("x", xScale(0))
                .attr("y", 70)
                .style("font-size", 16)
                // .style("font-family", "Roboto")
                .style("font-weight", 400);

                // Add x-axis text: distance in meters
                svg.append("text").text("100m")
                .attr("x", xScale(100))
                .attr("y", 500)
                .style("anchor", "middle");

                svg.append("text").text("2016")
                .attr("x", 60)
                .attr("y", yScale(2016))
                .style("anchor", "left")
                .style("fill", "blue")
                .style("opacity", .5);

                var seventy = svg.append("text").text("80m")
                .attr("x", xScale(80))
                .attr("y", 500)
                .style("anchor", "middle");

                var ninety = svg.append("text").text("90m")
                .attr("x", xScale(90))
                .attr("y", 500)
                .style("anchor", "middle");

                var fifty = svg.append("text").text("50m")
                .attr("x", xScale(50))
                .attr("y", 500)
                .style("anchor", "middle");

                seventy.transition()
                .duration(2000)
                    .attr('x', xScale(80) )
                     .transition()
                .duration(5000)
                    .attr('x', xScale2(80) )

                ninety.transition()
                .duration(2000)
                    .attr('x', xScale(90) )
                     .transition()
                .duration(5000)
                    .attr('x', xScale2(90) )

                fifty.transition()
                .duration(2000)
                    .attr('x', xScale(50) )
                     .transition()
                .duration(5000)
                    .attr('x', xScale2(50) )
                    .style("opacity", -5);
                
                // Initialize variables
                var countries = [];
                
                // Calls function for plotting descriptions
                plotTracksHover(data, circles);
                
                // Calls function for filtering by country
                
            }
            
            function plotTracksHover(data, objects) {
                
                // Append the rectangles
                var rects = svgGroup.selectAll('g').data(plottingData).enter().append('rect');
                
                // Append the flag iamges
                var flags = svgGroup.selectAll('g'). data(plottingData).enter().append('image');
                
                // Populate list of countries
                for (key in data) {
                    var c1 = data[key].gold.country;
                    if (countries.includes(c1) == false) {
                        countries.push(c1);
                    } 
                    var c2 = data[key].silver.country;
                    if (countries.includes(c2) == false) {
                        countries.push(c2); }
                    var c3 = data[key].bronze.country;
                    if (countries.includes(c3) == false) {
                        countries.push(c3);
                    }
                }
                // console.log(countries);
                
                // Append the text onto the rectangles
                var texts = svgGroup.selectAll('g').data(plottingData).enter().append('text');
                
                rects.attr('id', function(d) {return d.medal+d.year+d.game})
                    .attr('x', function(d) {return xScale2(d.end)-75})
                    .attr('rx', '6px')
                    .attr('ry', '6px')
                    .attr('width', '155px')
                    .attr('height', '70px')
                    .style('fill', 'lightgray')
                    .style('display', 'none');
                
                
                flags.attr('id', function(d) {return d.medal+d.year+d.game+'flag'})
                    .attr('xlink:href', function (d) {return 'img/flags/'+d.country+'.svg'})
                    .attr('x', function (d) {return xScale2(d.end)-65})
                    .attr('width', '25px')
                    .style('display','none');

                texts.attr('id', function(d) {return d.medal+d.year+d.game+'text'})
                    .attr('class', 'hover-athlete')
                    .attr('x', function(d) {return xScale2(d.end)-30})
                    .attr('width', '145px')
                    .attr('height', '65px')
                    // .style('fill', 'indianred')
                    .style('display', 'none')
                    .style('word-breal', 'all')
                    .text(function(d) {
                        var ath = d.athlete.split(' ');
                        var lastname = ath[1].charAt(0) + ath[1].slice(1).toLowerCase();
                        ath[1] = lastname;
                        return ath[0]+' '+ath[1];
                    });
                
                texts.append('tspan')
                    .attr('class', 'hover-desc')
                    .attr('x', function(d) {return xScale2(d.end)-30})
                    .attr('dy', '12px')
                    .text(function(d) {
                        return 'Country: '+d.country;
                    });
                
                texts.append('tspan')
                    .attr('class', 'hover-desc')
                    .attr('x', function (d) {return xScale2(d.end)-30})
                    .attr('dy', '12px')
                    .text(function(d) {
                        return 'Time: '+d.result;
                });
                    
                texts.append('tspan')
                    .attr('class', 'hover-desc')
                    .attr('x', function (d) {return xScale2(d.end)-30})
                    .attr('dy', '12px')
                    .text(function(d) {
                        return 'Speed: '+d.speed.toFixed(2)+' m/s';
                });   
                
                
                objects
                    .on('mouseenter', function(d) {
                    
                        var id = d.medal+d.year+d.game;
                        // console.log('click');
                        // console.log('#hover'+id);
                        // console.log(d3.select('#hover'+id));
                    
                        // If circles on upper half of graph
                        if (d.year >= 1968) {
                            rects.attr('y', function(d) {return yScale(d.order)+15});
                            flags.attr('y', function(d) {return yScale(d.order)+25});
                            texts.attr('y', function(d) {return yScale(d.order)+35});
                        } else { 
                            // if (d.year <= 1964)
                            rects.attr('y', function (d) {return yScale(d.order)-70-15});
                            flags.attr('y', function(d) {return yScale(d.order)-70-5});
                            texts.attr('y', function(d) {return yScale(d.order)-70+5});
                        }
                    
                        d3.select('#'+id).style('display', 'inline');
                        d3.select('#'+id+'flag').style('display', 'inline');
                        d3.select('#'+id+'text').style('display', 'inline');
                })
                .on('mouseleave', function(d) {
                    var id = d.medal+d.year+d.game;
                    d3.select('#'+id).style('display', 'none');
                    d3.select('#'+id+'flag').style('display', 'none');
                    d3.select('#'+id+'text').style('display', 'none');
                });
            }

        </script>
        
        <script>
            // Legend: circle colors
            var goldMedal = svgGroup.append("circle")
            .attr("cx", 1150).attr("cy", 150)
            .attr("r", 8)
            .style("fill", "gold");
            
            var silverMedal = svgGroup.append("circle")
            .attr("cx", 1200).attr("cy", 150)
            .attr("r", 8)
            .style("fill", "grey");
            
            var bronzeMedal = svgGroup.append("circle")
            .attr("cx", 1250).attr("cy", 150)
            .attr("r",8)
            .style("fill", "orange");
            
            
            // Record Holder
            
            var recordHolder = svgGroup.append("text")
            .text("Record: 9.63 seconds")
            .attr("x", 1100).attr("y", 200);
            
            // Filter: by countries
            
        </script>
    </p>
    </div>
    
    <div id='plotCountries'></div>
    <script>
        // Country data visualization
        
        // Create SVG
        var svgCountry = d3.select('#plotCountries').append("svg")
            .attr("width", 1400)
            .attr("height", 2300);
        var svgCountryGroup = svgCountry.append('g');
        
        
        // Create country array
        var cData = [];
        
        // Append country flags
        function plotCountries(data) {
            
            var counter = 0;
            for (c in data) {
                
                cData.push({country: c, total: data[c].total, gold: data[c].gold, silver: data[c].silver, bronze: data[c].bronze, byyear: data[c].byyear})
                
                // Append the flag iamges
                var countries = svgCountryGroup.append('image');
                
                countries.attr('id', ''+counter+c)
                    .attr('xlink:href', function () {
                        if (c=='EUN' || c=='None') {
                            return ;
                        } else {
                            return 'img/flags/'+c+'.svg';
                        }  
                    })
                    .attr('x', '50px')
                    .attr('y', 50+50*counter)
                    .attr('width', '25px');
                
                // Append the country names
                var cNames = svgCountryGroup.append('text');
                
                cNames
                    .attr('class', 'hover-athlete')
                    .attr('x', '90px')
                    .attr('y', 68+50*counter)
                    .text(c);
                
                // Append the years
                for (y=0; y<31; y++) {
                    // yrs.selectAll('g').data(cData).enter().append('rect')
                    var yrs = svgCountryGroup.selectAll('g').data(cData).enter().append('rect');
                    yrs
                        .attr('x', 150+15*y)
                        .attr('y', 60+50*counter)
                        .attr('width', '10px')
                        .attr('height', '10px')
                        .attr('fill', function(d) {
                        console.log();
                            var yr = 1896+y*4;
                        
                            // If country won an award that year
                            if (data[c].byyear[yr]) {
                                
                                // If country won more than one award that year
//                                var n = data[c].byyear[yr].t;
//                                console.log(n);
//                                for (z=0; z<n; z++) {
//                                    yrs.append('rect')
//                                        .attr('x', 150+15*y)
//                                        .attr('y', 60+50*counter - z*15)
//                                        .attr('width', '10px')
//                                        .attr('height', '10px')
//                                        .attr('fill', 'salmon');
//                                        // .style('display', 'none');
//                                } 
                                
                                return 'salmon';
                            } else {
                                return 'lightgray';
                            }
                        })
                        .on('mouseenter', function(d) {
                            // console.log(d);
                        });
                    
                // Hover over the years
                // yrs.on('mouseenter', function(d) {
                    // console.log('mouseeenter');
                    // console.log(d);
                    
                    // d3.select('#'+c+'squares').style('display', 'inline');
                //});
                    
                }
                
                counter += 1;
            
            }
        }
        
        
        
    </script>
    
    <div class = "bottomGraph">
        <p id = "sliders">
             <input type="range" min="0" max="2" id="dataSlider" >
        </p>

        <p id = "bottomGraph">
            <script>
                var width = 1400, height = 600;
                
                // Create SVG
                var svg2 = d3.select("#bottomGraph")
                .append("svg")
                .attr("class", "scatterPlot")
                .attr("width", width)
                .attr("height", height);
                
                var slider = document.getElementById("dataSlider");
                slider.defaultValue = 0;

                var svgGroup2 = svg2.append("g").attr("transform", "translate(600,50)");
                var POI = svg2.append("g").attr("transform", "translate(600,50)");
                var yLabels = svg2.append("g").attr("transform", "translate(600,50)");;
                
                var visualGroup = svg2.append("g");
                var changingVisual = svg2.append("g");
                
            
                
                svg2.append("text").text("Running Faster, and Faster")
                .attr("x", 100)
                .attr("y", 70)
                .style("fill", "lightGrey")
                .style("font-size", 25)
                // .style("font-family", "Roboto")
                .style("font-weight", 400);
                
                svg2.append("text").text("See how humans compare ")
                .attr("x", 100)
                .attr("y", 100)
                .style("fill", "lightGrey")
                .style("font-size", 16)
                // .style("font-family", "Roboto")
                .style("font-weight", 200);
                
                // Meters per second
                var cheetah = 1916.667;
                var tRex = 11.176;
                var earth = 447.04;
                var highway = 31.2928;
                                
                
                function updatePlot(value) {
                    createPlot(mens100m,value)
                    visual(value);
                }
                
                visualGroup.append("image")
                        .attr("xlink:href", "img/sport.svg")
                        .attr("x", "180")
                        .attr("y", "200")
                        .attr("width", "80");
                
                visualGroup.append("text").text("FASTEST MAN")
                .attr("x", "160")
                .attr("y", "320")
                .style("fill", "lightGrey")
                // .style("font-family", "Roboto")
                .style("font-weight", 200);
                    
                visualGroup.append("image")
                        .attr("xlink:href", "img/greater.svg")
                        .attr("x", "300")
                        .attr("y", "225")
                        .attr("width", "40");
                
                changingVisual.append("image")
                        .attr("xlink:href","img/olympic.svg")
                        .attr("x", "380")
                        .attr("y", "160")
                        .attr("width", "150");
                
                visualGroup.append("text").text("OLYMPIC ATHLETES")
                .attr("x", "380")
                .attr("y", "320")
                .style("fill", "lightGrey")
                // .style("font-family", "Roboto")
                .style("font-weight", 200);
                
                visualGroup.append("text").text("2012")
                .attr("x", "250")
                .attr("y", "400")
                .style("fill", "#1ABC9C")
                // .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("font-size", 36);
                
                visualGroup.append("text").text(Math.round(100*recordSpeed)/100 + " m/s")
                .attr("x", "350")
                .attr("y", "400")
                .style("fill", "#F7DC6F")
                // .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("font-size", 36);
                
                function visual(value) {               
                    
                    changingVisual.selectAll("image").remove();
                    
                    if (value == 0){
                        
                        changingVisual.append("image")
                        .attr("xlink:href", "olympic.svg")
                        .attr("x", "380")
                        .attr("y", "100")
                        .attr("width", "150")
                        .style("opacity", "0");
                        
                        changingVisual.selectAll("image")
                        .transition().duration(200)
                            .attr("y", 160)
                            .style("opacity", 1);  
                                                
                    }
                    
                    else if (value == 1){
                    
                    
                        changingVisual.append("image")
                        .attr("xlink:href", "tRex.svg")
                        .attr("x", "350")
                        .attr("y", "100")
                        .attr("width", "200")
                        .style("opacity", "0");
                        
                        changingVisual.selectAll("image")
                        .transition().duration(200)
                            .attr("y", 150)
                            .style("opacity", 1); 
                        
                    }
                    
                    else {
                        
                        changingVisual.append("image")
                        .attr("xlink:href", "tRex.svg")
                        .attr("x", "350")
                        .attr("y", "150")
                        .attr("width", "200");
                    }
                }
                
                function createPlot (speedData, stage) {
                    
                    
                    yearData  = []; // Years
                    resultData = []; // Gold results
                    
                    for (year in speedData){
                        yearData.push(Number(year));
                        resultData.push(speedData[year].gold.speed);
                    }
                    
                    var model = leastSquares(yearData,resultData);
                    
                    var regressionLine = []
                    
                    var tRexYear = Math.round((tRex - model.intercept)/model.slope);
                    var highwayYear = Math.round((highway - model.intercept)/model.slope);
                    var earthYear = Math.round((earth - model.intercept)/model.slope);
                    var cheetahYear = Math.round((cheetah-model.intercept)/model.slope);
                    
                    var years = [[1900, 1910, 1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020], [2016, tRexYear], [2016, tRexYear, highwayYear]];
                    
                    var results = [[9.2, 9.4, 9.6, 9.8, 10.0, 10.2, 10.4], [10.5, tRex], [10.5, tRex, highway]];
                    
                    var pointsOfInterest = [[2012,10.384215991692626]];
                    
                    
                    if (stage == 0) {
                        var startYear = 1900;
                        var endYear = 2016;
                        
                        var interval = years[0];
                        var yinterval = results[0];
                        var maxSpeed = d3.max(resultData);
                        
                    }
                    
                    else if (stage == 1) {
                        var startYear = 1900;
                        var endYear = tRexYear;
                        
                        var interval = years[1];
                        var yinterval = results[1];
                        var maxSpeed = tRex;
                        
                        yearData.push(tRexYear);
                        resultData.push(tRex)
                        
                        var pointsOfInterest = [[2012,10.384215991692626], [tRexYear, tRex]];
                        
                    }
                    
                    else if (stage == 2) {
                        var startYear = 1900;
                        var endYear = highwayYear;
                        
                        var interval = years[2];
                        var yinterval = results[2];
                        var maxSpeed = highway;
                        
                        yearData.push(tRexYear, highwayYear);
                        resultData.push(tRex, highway)
                        
                        var pointsOfInterest = [[2012,10.384215991692626], [highwayYear, highway]];
                    }
                    
                    var minSpeed = startYear*model.slope + model.intercept ;
                    
                    var yScale = d3.scaleLinear().domain([minSpeed,maxSpeed]).range([300,100]);
                
                    var xScale = d3.scaleLinear().domain([startYear, endYear]).range([100, 500]);
                    
                    
                    regressionLine.push({x1: startYear, y1: model.slope * startYear + model.intercept,
                    x2: endYear, y2: model.slope * endYear + model.intercept})
                    
                    
                    // Draw least squares line
                    
                    svgGroup2.selectAll("line").data(regressionLine)
                    .enter().append("line")
                    .style("stroke", "#5D6D7E ")
                    .attr("x1", function(d) {return xScale(d.x1)})
                    .attr("y1", function(d) {return yScale(d.y1)})
                    .attr("x2", function(d) {return xScale(d.x2)})
                    .attr("y2", function(d) {return yScale(d.y2)});
                    
                    svgGroup2.selectAll("line").data(regressionLine)
                    .transition().duration(1000)
                    .attr("x1", function(d) {return xScale(d.x1)})
                    .attr("y1", function(d) {return yScale(d.y1)})
                    .attr("x2", function(d) {return xScale(d.x2)})
                    .attr("y2", function(d) {return yScale(d.y2)});
                    
                    
                    // Plot data points
                    
                    var circles = svgGroup2.selectAll("circle").data(resultData);
                    
                    circles.enter().append("circle")
                    .attr("r", function(d,i) { return updateDotSize(d,i,stage) })
                    .style("fill", function(d,i) { return updateDotColors(d,i,stage) })
                    .attr("cx", function(d,i) { return xScale(yearData[i]) })
                    .attr("cy",function(d) { return yScale(d) }); 
                    
                    
                    var interestingPoints = POI.selectAll("circle").data(pointsOfInterest);
                    
                    interestingPoints.enter().append("circle")
                    .attr("r", 15)
                    .style("fill", "white")
                    .attr("cx", function(d,i) { return xScale(d[0]) })
                    .attr("cy",function(d) { return yScale(d[1]) })
                    .style("opacity", .2); 
                    
                    interestingPoints.transition()
                    .duration(2500).attr("cx", function(d,i) {return xScale(d[0])})
                    .attr("cy",function(d) {return yScale(d[1])})

                    // Update Positions
                    circles.transition()
                    .duration(2500).attr("cx", function(d,i) {return xScale(yearData[i])})
                    .attr("r", function(d,i) { return updateDotSize(d,i,stage) })
                    .attr("cy",function(d) {return yScale(d)})
                    .style("fill", function(d,i) { return updateDotColors(d,i,stage)});
                    
                     
                    circles.exit().remove();
                    interestingPoints.exit().remove();
                    

                    // Add axis
                    
                    var plotInterval = svgGroup2.selectAll("text").data(interval);
                    
                    plotInterval.enter().append("text")
                    .attr("y", 350)
                    .style("anchor", "middle")
                    .text(function(d){return d.toString()})
                    .attr("x", function(d) {return xScale(d)})
                    .style("font-size", 10);
                    
                    
                    plotInterval.transition()
                    .duration(1000)
                    .text(function(d){return d.toString()})
                    .attr("x", function(d) {return xScale(d)});
                    
                     plotInterval.exit().remove();
                    
                    
                    var plotSpeeds = yLabels.selectAll("text").data(yinterval);
                    
                    plotSpeeds.enter().append("text")
                    .text(function(d){return (Math.round(100*d)/100).toString()})
                    .attr("y", function(d){return yScale(d)})
                    .attr("x", 50)
                    .style("anchor", "middle")
                    .style("font-size", 10);
                    
                    plotSpeeds.exit().remove();
                    
                    plotSpeeds.transition().duration(1000)
                    .text(function(d){return d.toString()})
                    .text(function(d){return (Math.round(100*d)/100).toString()})
                    .attr("y", function(d){return yScale(d)})
                    
                }
                
                
                // Update the colors of the data points in the scatter plot according to stage set by slider
                function updateDotColors(d,i, stage) {
                    if (stage == 0){
                        if (d == 10.384215991692626) {return "white"}
                        else {return "#1ABC9C"}
                    }
                    else {
                        if (i == resultData.length - 1) {return "white"}
                        if (d == 10.384215991692626) {return "white"}
                        else {return "#1ABC9C"}
                    }
                }

                
                // Update the radius of the data points in the scatter plot according to stage set by slider
                function updateDotSize(d,i,stage) {
                    if (stage == 0){
                        if (d == 10.384215991692626) {return 4}
                        else {return 4}
                    }
                    else {
                        if (d == 10.384215991692626) {return 4}
                        if (i == resultData.length -1) {return 4}
                        else {return 4}
                    }
                }
                
                 
                function leastSquares(xData,yData) {
                    var model = { intercept: 0, slope: 0 };

                    if (xData.length == 0) { return model; }

                    var meanX = d3.mean(xData);

                    var meanY = d3.mean(yData);

                    model.slope = d3.sum(xData, function (d,i) {
                        return (xData[i] - meanX) * (yData[i] - meanY);
                    });

                    model.slope /= d3.sum(xData, function (d,i) {
                        return (xData[i] - meanX) * (xData[i] - meanY);
                    });

                    model.intercept = meanY - model.slope * meanX;
                    return model;
              }


                
            </script>
        </p>
    </div>
</body>

</html>