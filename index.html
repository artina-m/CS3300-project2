<!DOCTYPE html>
<html>
<head>
    <title>CS 3300 Project 2 </title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel = "stylesheet" type="text/css" href = "index.css">
</head>

<body>
    <div>
    <p>
        <script>
        
        function plotHistogram(svg, numbers) {
            console.log(numbers)
            var width = 400; var height = 250;
            
            
            // Linear scale for x axis
            var xScale = d3.scaleLinear()
            .domain([0, 25])
            .range([50,width-50]);
            
            // Create a histogram
            g = svg.append("g")
                
            
            var yScale = d3.scaleLinear()
            .domain([9,10.5])
            .range([height-50,50]);
            
        
            
            numbers.forEach(function(d,i) {
            // Create a histogram using svg rectangles
                    g.append("rect")
                        .attr("x", xScale(i))
                        .attr("y", yScale(d))
                        .attr("width", 10)
                        .attr("height", yScale(9) - yScale(d))
                        .attr("fill", "blue")
                        .style("opacity", .5);
            });
                
            var xAxis = d3.axisBottom(xScale)
            .tickSize(3);
            
            g.append("g").call(xAxis)
            .attr("transform", "translate(0,150)")
            .style("font-size", 10);
            
            var yAxis = d3.axisLeft(yScale)
            .tickSize(3);
            
            g.append("g").call(yAxis)
            .attr("transform", "translate(50,0)")
            .style("font-size", 10);  
            
            g.attr("transform","translate(50,550)")
        
        }
    
        
        </script>
        <script>
            // Olympic Games of interest
            var mens100m  = {};
            var womens100m  = {};
            
            function parseLine(line) {
                return {
                    game: line["Game"],
                    year: line["Year"],
                    medal: line["Medal"],
                    result: Number(line["Result"]),
                    country: line["Country"],
                    athlete: line["Athlete"]
                }
            }
            
            // Create objects for gold, silver, and bronze results.
            // Update the data object olympicResults to include new results
            function olympicYearResults (olympicResults, d){
                if (d.medal == "gold"){
                    olympicResults[d.year].gold = {result: d.result, athlete: d.athlete, country: d.country};
                }
                if (d.medal == "silver"){
                    olympicResults[d.year].silver = {result: d.result, athlete: d.athlete, country: d.country};
                }
                if (d.medal == "bronze"){
                    olympicResults[d.year].bronze = {result: d.result, athlete: d.athlete, country: d.country};
                }
            }
            
            d3.csv("olympicData.csv", parseLine, function(error,data){
                olympicData = data;
                
                // Create object for each olympic game (key = year)
                olympicData.forEach(function(d){
                    
                    if (d.game == "100M Men"){ mens100m[d.year]= {} }
                    
                    else if (d.game == "100M Women") { womens100m[d.year] = {} }
                })
                
                // Create object for every year's results (keys =  gold, silver and bronze )
                olympicData.forEach(function(d){
                    
                    if (d.game == "100M Men"){ olympicYearResults(mens100m, d); }
                    
                    if (d.game == "100M Women"){ olympicYearResults(womens100m, d); }
                });
                
                plotTracks(mens100m)
                
            });
            
        </script>
    </p>
        
    <p id = "trackViz">

        <script>
        
            var width = 1400, height = 700;
            
            var xScale = d3.scaleLinear().domain([0,100]).range([100,1000]);
                
            var xScale2 = d3.scaleLinear().domain([80,100]).range([100,1000]);
            
            var yScale = d3.scaleLinear().domain([0,25]).range([490,90]);
            
            
            var svg = d3.select("#trackViz").append("svg")
            .attr("width", width)
            .attr("height", height)
            ;
            
            var svgGroup = svg.append("g");

            var recordTime = 9.63;
            var recordSpeed = 100/9.63;
            var speeds = []; // get speeds
            var years = []; // get years 
            
            function plotTracks(data) {
                plottingData  = [];
                years = [];
                
                goldStart = [];
                goldEnd = [];
                goldY = [];
                
                silverStart = [];
                silverEnd = [];
                silverY = [];
                
                bronzeStart = [];
                bronzeEnd = [];
                bronzeY = [];
                                

                n = 1;
                for (y in data){
                    
                    var goldSpeed = 100/data[y].gold.result;
                    speeds.push(goldSpeed);
                    var goldDistance = goldSpeed*recordTime;
                    
                    plottingData.push({start: 0, end: goldDistance, color: "gold", year: y, order: n});
                    
                    
                    var silverSpeed = 100/data[y].silver.result;
                    var silverDistance = silverSpeed*recordTime;
                    
                    plottingData.push({start: 0, end: silverDistance, color: "grey", year: y, order: n});
                    
                                        
                   var bronzeSpeed = 100/data[y].bronze.result;
                   var bronzeDistance = bronzeSpeed*recordTime;
                    
                    plottingData.push({start: 0, end: bronzeDistance, color: "orange", year: y, order:n});
                    
                    n++;
                    
                } 
            
                
                // Add track for each olympic year
                var raceTrack = svgGroup.selectAll("rect").data(plottingData).enter().append("rect");
                
                raceTrack.attr("width", 900).attr("height",14 )
                .attr("x",100).attr("y", function(d) {return(yScale(d.order) - 7)})
                .style("fill", "lightGrey")
                .style("opacity", .1);
                
                // Finish Line
                svgGroup.append("rect")
                .attr("x", xScale(100))
                .attr("y", yScale(25))
                .attr("width", 50)
                .attr("height", 400)
                .style("fill", "white")
                .style("stroke", "grey")
                .style("stroke-width", .5);
                
                svgGroup.append("text").text("FINISH")
                .attr("x", -300)
                .attr("y", 1035)
                .attr("transform", "rotate(270)")
                .style("text-anchor", "middle")
                .style("font-size", 25)
                .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");
                
                // Add gold, bronze, and silver medal plots
                var circles = svgGroup.selectAll("circle").data(plottingData).enter().append("circle");
                
                circles
                .attr("cx", function(d) {return xScale(d.start)})
                .attr("cy",function(d) {return yScale(d.order)})
                .attr("r", 5)
                .style("fill", function(d) {return d.color});
                
                circles.transition()
                .duration(2000)
                    .attr('cx', function(d,i) { return xScale(d.end) })
                .transition()
                .duration(5000)
                    .attr('cx', function(d,i) { return xScale2(d.end) });
                
                
                // Add y-axis text: years
                console.log(plottingData);
                var olympicYears = svg.selectAll("text").data(plottingData).enter().append("text");
                
                olympicYears.text(function(d) {return d.year})
                .attr("x", 50)
                .attr("y", function(d) {console.log(d.order);return yScale(d.order)})
                .style("alignment-baseline", "middle")
                .style("font-size", 12)
                .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");
                
                
                // Add titles
                svg.append("text").text("Olympic 100M Mens")
                .attr("x", xScale(0))
                .attr("y", 45)
                .style("font-size", 25)
                .style("font-family", "Roboto")
                .style("font-weight", 600);

                svg.append("text").text("If all Olympians raced the same race")
                .attr("x", xScale(0))
                .attr("y", 70)
                .style("font-size", 16)
                .style("font-family", "Roboto")
                .style("font-weight", 400);
                
                // Add x-axis text: distance in meters
                svg.append("text").text("100m")
                .attr("x", xScale(100))
                .attr("y", 500)
                .style("anchor", "middle");
                
                svg.append("text").text("2016")
                .attr("x", 60)
                .attr("y", yScale(2016))
                .style("anchor", "left")
                .style("fill", "blue")
                .style("opacity", .5);
                
                var seventy = svg.append("text").text("80m")
                .attr("x", xScale(80))
                .attr("y", 500)
                .style("anchor", "middle");
                
                var ninety = svg.append("text").text("90m")
                .attr("x", xScale(90))
                .attr("y", 500)
                .style("anchor", "middle");
                
                var fifty = svg.append("text").text("50m")
                .attr("x", xScale(50))
                .attr("y", 500)
                .style("anchor", "middle");
                
                
                seventy.transition()
                .duration(2000)
                    .attr('x', xScale(80) )
                     .transition()
                .duration(5000)
                    .attr('x', xScale2(80) )
                
                ninety.transition()
                .duration(2000)
                    .attr('x', xScale(90) )
                     .transition()
                .duration(5000)
                    .attr('x', xScale2(90) )
                
                fifty.transition()
                .duration(2000)
                    .attr('x', xScale(50) )
                     .transition()
                .duration(5000)
                    .attr('x', xScale2(50) )
                    .style("opacity", -5);
                
                plotHistogram(svg, speeds);
            
            }
             svg.append("text").text("Have we reached our peak?")
            .attr("x", xScale(0))
            .attr("y", 550)
            .style("font-size", 16)
            .style("font-family", "Roboto")
            .style("font-weight", 600);
            
            
            
            // Add legend, also filter by medals?
            var goldMedal = svgGroup.append("circle")
            
            goldMedal.attr("cx", 1150).attr("cy", 150)
            .attr("r", 8)
            .style("fill", "gold");
            
            var silverMedal = svgGroup.append("circle")
            
            silverMedal.attr("cx", 1200).attr("cy", 150)
            .attr("r", 8)
            .style("fill", "grey");
            
            var bronzeMedal = svgGroup.append("circle")
            
            bronzeMedal.attr("cx", 1250).attr("cy", 150)
            .attr("r",8)
            .style("fill", "orange");

        </script>

    </p>
    </div>
</body>

</html>