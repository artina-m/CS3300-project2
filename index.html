<!DOCTYPE html>
<html>
<head>
    <title>CS 3300 Project 2 </title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel = "stylesheet" type="text/css" href = "index.css">
</head>

<body>
    <div>
    <p>     
        <script>
            // Olympic Games of interest
            var mens100m  = {}; // result (time), athlete, country, speed
            var womens100m  = {};
            
            function parseLine(line) {
                return {
                    game: line["Game"],
                    year: line["Year"],
                    medal: line["Medal"],
                    result: Number(line["Result"]),
                    country: line["Country"],
                    athlete: line["Athlete"]
                }
            }
            
            // Create objects for gold, silver, and bronze results.
            // Update the data object olympicResults to include new results
            function olympicYearResults (olympicResults, d){
                if (d.medal == "gold"){
                    olympicResults[d.year].gold = {result: d.result, athlete: d.athlete, country: d.country};
                }
                if (d.medal == "silver"){
                    olympicResults[d.year].silver = {result: d.result, athlete: d.athlete, country: d.country};
                }
                if (d.medal == "bronze"){
                    olympicResults[d.year].bronze = {result: d.result, athlete: d.athlete, country: d.country};
                }
            }
            
            d3.csv("olympicData.csv", parseLine, function(error,data){
                olympicData = data;
                
                // Create object for each olympic game (key = year)
                olympicData.forEach(function(d){
                    
                    if (d.game == "100M Men"){ mens100m[d.year]= {} }
                    
                    else if (d.game == "100M Women") { womens100m[d.year] = {} }
                })
                
                // Create object for every year's results (keys =  gold, silver and bronze )
                olympicData.forEach(function(d){
                    
                    if (d.game == "100M Men"){ olympicYearResults(mens100m, d); }
                    
                    if (d.game == "100M Women"){ olympicYearResults(womens100m, d); }
                });
                
                // Add speeds to object: 100m / result
                for (year in mens100m){
                    mens100m[year].gold.speed = 100.0/mens100m[year].gold.result;
                    mens100m[year].silver.speed = 100.0/mens100m[year].silver.result;
                    mens100m[year].bronze.speed = 100.0/mens100m[year].bronze.result;
                };
                                
                plotTracks(mens100m);
                
                createPlot(yearScale, speedScale, mens100m);
            });
                        
        </script>
    </p>
        
    <p id = "trackViz">

        <script>
            
            var width = 1400, height = 600;

            var xScale = d3.scaleLinear().domain([0,100]).range([100,1000]);

            var xScale2 = d3.scaleLinear().domain([80,100]).range([100,1000]); // zoom into points

            var yScale = d3.scaleLinear().domain([0,25]).range([490,90]);

            // Create SVG
            var svg = d3.select("#trackViz")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

            var svgGroup = svg.append("g");
            
            // 100M Men's Record
            var recordTime = 9.63; 
            var recordSpeed = 100/9.63;
            
            function plotTracks(data) {
                
                var plottingData  = []; // Array of objects
    
                n = 1;
                
                for (y in data){
                    
                    var goldDistance = data[y].gold.speed*recordTime;
                    
                    plottingData.push({start: 0, end: goldDistance, speed:data[y].gold.speed, result: data[y].gold.speed.result, color: "gold", year: y, order: n});
                            
                    var silverDistance = data[y].silver.speed*recordTime;
                    plottingData.push({start: 0, end: silverDistance, speed:data[y].silver.speed, result: data[y].silver.result, color: "grey", year: y, order: n});
                    
                    var bronzeDistance = data[y].bronze.speed*recordTime;
                    plottingData.push({start: 0, end: bronzeDistance,speed:data[y].bronze.speed, result: data[y].bronze.result, color: "orange", year: y, order:n});
                    
                    n++;
                    
            }
                            
            // Add track for each olympic year
            var raceTrack = svgGroup.selectAll("g").data(plottingData).enter().append("rect");

            raceTrack.attr("width", 900).attr("height",14 )
            .attr("x",100).attr("y", function(d) {return(yScale(d.order) - 7)})
            .style("fill", "lightGrey")
            .style("opacity", .1);

            // Finish Line
            svgGroup.append("rect")
            .attr("x", xScale(100))
            .attr("y", yScale(25))
            .attr("width", 50)
            .attr("height", 400)
            .style("fill", "white")
            .style("stroke", "grey")
            .style("stroke-width", .5);

            svgGroup.append("text").text("FINISH")
            .attr("x", -300)
            .attr("y", 1035)
            .attr("transform", "rotate(270)")
            .style("text-anchor", "middle")
            .style("font-size", 25)
            .style("font-family", "Roboto")
            .style("font-weight", 200)
            .style("fill", "grey");

            // Add gold, bronze, and silver medal plots
            var circles = svgGroup.selectAll("g").data(plottingData)
            .enter().append("circle");

            circles.attr("cx", function(d) {return xScale(d.start)})
            .attr("cy",function(d) {return yScale(d.order)})
            .attr("r", 5)
            .style("fill", function(d) {return d.color});

            circles.transition()
            .duration(2000)
                .attr('cx', function(d,i) { return xScale(d.end) })
            .transition()
            .duration(5000)
                .attr('cx', function(d,i) { return xScale2(d.end) });


            // Add y-axis text: years
            var olympicYears = svg.selectAll("g").data(plottingData).enter().append("text");

            olympicYears.text(function(d) {return d.year})
            .attr("x", 50)
            .attr("y", function(d) {return yScale(d.order)})
            .style("alignment-baseline", "middle")
            .style("font-size", 12)
            .style("font-family", "Roboto")
            .style("font-weight", 200)
            .style("fill", "grey");


            // Add titles
            svg.append("text").text("Olympic 100M Mens")
            .attr("x", xScale(0))
            .attr("y", 45)
            .style("font-size", 25)
            .style("font-family", "Roboto")
            .style("font-weight", 600);

            svg.append("text").text("If all Olympians raced the same race")
            .attr("x", xScale(0))
            .attr("y", 70)
            .style("font-size", 16)
            .style("font-family", "Roboto")
            .style("font-weight", 400);

            // Add x-axis text: distance in meters
            svg.append("text").text("100m")
            .attr("x", xScale(100))
            .attr("y", 500)
            .style("anchor", "middle");

            svg.append("text").text("2016")
            .attr("x", 60)
            .attr("y", yScale(2016))
            .style("anchor", "left")
            .style("fill", "blue")
            .style("opacity", .5);

            var seventy = svg.append("text").text("80m")
            .attr("x", xScale(80))
            .attr("y", 500)
            .style("anchor", "middle");

            var ninety = svg.append("text").text("90m")
            .attr("x", xScale(90))
            .attr("y", 500)
            .style("anchor", "middle");

            var fifty = svg.append("text").text("50m")
            .attr("x", xScale(50))
            .attr("y", 500)
            .style("anchor", "middle");


            seventy.transition()
            .duration(2000)
                .attr('x', xScale(80) )
                 .transition()
            .duration(5000)
                .attr('x', xScale2(80) )

            ninety.transition()
            .duration(2000)
                .attr('x', xScale(90) )
                 .transition()
            .duration(5000)
                .attr('x', xScale2(90) )

            fifty.transition()
            .duration(2000)
                .attr('x', xScale(50) )
                 .transition()
            .duration(5000)
                .attr('x', xScale2(50) )
                .style("opacity", -5);
                
            
            }

        </script>
        
        <script>
             // Add legend, also filter by medals?
            var goldMedal = svgGroup.append("circle")
            .attr("cx", 1150).attr("cy", 150)
            .attr("r", 8)
            .style("fill", "gold");
            
            var silverMedal = svgGroup.append("circle")
            .attr("cx", 1200).attr("cy", 150)
            .attr("r", 8)
            .style("fill", "grey");
            
            var bronzeMedal = svgGroup.append("circle")
            .attr("cx", 1250).attr("cy", 150)
            .attr("r",8)
            .style("fill", "orange");
            
            
            // Record Holder
            
            var recordHolder = svgGroup.append("text")
            .text("Record: 9.63 seconds")
            .attr("x", 1100).attr("y", 200);

        </script>
    </p>
    </div>
    
    <div class = "bottomGraph">
        <p id = "bottomGraph">
            <script>
                var width = 1400, height = 600;
                
                // Create SVG
                var svg2 = d3.select("#bottomGraph")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

                var svgGroup2 = svg2.append("g");
                
                var speedScale = d3.scaleLinear().domain([9,10.5]).range([500,100]);
                
                var yearScale = d3.scaleLinear().domain([1900, 2016]).range([100, 500]);
                
                svg2.append("text").text("Pushing the Limits")
                .attr("x", 100)
                .attr("y", 70)
                .style("font-size", 20)
                .style("font-family", "Roboto")
                .style("font-weight", 400);
                
                var cheetah = 1916.667;
                var tRex = 11.176;
                var earth = 447.04;
                var highway = 31.2928;
                
                function createPlot (xScale, yScale, speedData) {
                    yearData  = []; // Years
                    resultData = []; // Gold results
                    
                    for (year in speedData){
                        yearData.push(Number(year));
                        resultData.push(speedData[year].gold.speed);
                    }
                    
                    
                    var circles = svgGroup2.selectAll("g").data(resultData)
                    .enter().append("circle")
                    .attr("cx", function(d,i) {return xScale(yearData[i])})
                    .attr("cy",function(d) {return yScale(d)})
                    .attr("r", 5)
                    .style("fill", "gold");   
                    
                    // Add axis
                    var xAxis = d3.axisBottom(xScale)
                    .tickSize(3);

                    var yAxis = d3.axisLeft(yScale)
                    .tickSize(3);

                    svgGroup2.append("g").call(xAxis)
                    .attr("transform", "translate(0,500)")
                    .style("font-size", 10);

                    svgGroup2.append("g").call(yAxis)
                    .attr("transform", "translate(100,0)")
                    .style("font-size", 10); 
                    
                    var model = leastSquares(yearData,resultData);
                    
                    var yMin = d3.min(resultData);      

                    var regressionLine = svgGroup2.append("line")
                    .attr("x1", xScale(1900))
                    .attr("y1", yScale(model.slope * 1900 + model.intercept))
                    .attr("x2", xScale(2016))
                    .attr("y2", yScale(model.slope * 2016 + model.intercept))
                    .style("stroke", "blue");
             }
                
                
                function leastSquares(xData,yData) {
                var model = { intercept: 0, slope: 0 };

                if (xData.length == 0) { return model; }

                var meanX = d3.mean(xData);

                var meanY = d3.mean(yData);

                model.slope = d3.sum(xData, function (d,i) {
                    return (xData[i] - meanX) * (yData[i] - meanY);
                });
                    
                console.log(model.slope)
                model.slope /= d3.sum(xData, function (d,i) {
                    return (xData[i] - meanX) * (xData[i] - meanY);
                });

                model.intercept = meanY - model.slope * meanX;
                return model;
                    
              }


                
            </script>
        </p>
    </div>
</body>

</html>