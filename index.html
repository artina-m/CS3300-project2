<!DOCTYPE html>
<html>
<head>
    <title>INFO 3300 Project 2 </title>
    <meta name="description" content="INFO 3300 Project 2">
    <meta charset="utf-8">
    
    <!-- Load d3, topojson & AJAX -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="http://d3js.org/topojson.v2.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script><script src="https://d3js.org/d3.v4.min.js"></script>
    
    <link rel = "stylesheet" type="text/css" href = "style.css">
    
    <!-- Font -->
        <!--    extra-light 200
                light 300
                regular 400
                semi-bold 600
                bold 700
                extra-bold 800
                black 900-->
    <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
</head>

<body>
    <h1>The Olympians</h1>
    <h3>If all Olympians entered the same Olympics.</h3>
    
    <div>
    <p>     
        <button id="showTrack" class="topButtons"> 100M Track </button>
        <button id="showPool" class="topButtons"> 200M Butterfly </button>
        <button id="showDiscus" class="topButtons"> Discus Throw </button>

        <script>
            // Olympic Games of interest
            var mens100m  = {}; // result (time), athlete, country, speed
            var womens100m  = {};
            var mens200mFly = {}; 
            var womens200mFly = {};
            var mensDiscus = {};
            var womensDiscus = {};

            // Olympic Games by country
            // key: country
            // data: # medals, # gold, # silver, # bronze
            // data: [year: # medals, # gold, # bronze]
            var countryData = {};
            
            function parseLine(line) {
                var csvLine = {
                    game: line["Game"],
                    year: line["Year"],
                    medal: line["Medal"],
                    result: line["Result"],
                    country: line["Country"],
                    athlete: line["Athlete"]
                }
                if (csvLine.game == "200M Butterfly Men" || csvLine.game == "200M Butterfly Women") {
                    var time = csvLine.result.replace(/^0+(?!\.|$)/, ''); // remove leading zeros of time result e.g. "01:55.35"
                    time = Number(time.charAt(0)) * 60 + Number(time.substr(2)); // # of minutes * 60 seconds + seconds.milliseconds
                    csvLine.result = time;
                } else {
                    csvLine.result = Number(csvLine.result);
                }
                return csvLine;
            }
            
            // Create objects for gold, silver, and bronze results.
            // Update the data object olympicResults to include new results
            function olympicYearResults (olympicResults, d){
                var game = (d.game).replace(/\s/g, '').toLowerCase();
                if (d.medal == "gold"){
                    olympicResults[d.year].gold = {game: game, result: d.result, athlete: d.athlete, country: d.country};
                }
                if (d.medal == "silver"){
                    olympicResults[d.year].silver = {game: game, result: d.result, athlete: d.athlete, country: d.country};
                }
                if (d.medal == "bronze"){
                    olympicResults[d.year].bronze = {game: game, result: d.result, athlete: d.athlete, country: d.country};
                }
            }    
            
            d3.csv("olympicData.csv", parseLine, function(error,data){
                olympicData = data;
                
                // Create object for each olympic game (key = year)
                olympicData.forEach(function(d){
                    
                    if (d.game == "100M Men"){ mens100m[d.year]= {} }
                    
                    else if (d.game == "100M Women") { womens100m[d.year] = {} }

                    else if (d.game == "200M Butterfly Men") { mens200mFly[d.year] = {} }

                    else if (d.game == "200M Butterfly Women") { womens200mFly[d.year] = {} }

                    else if (d.game == "Discus Throw Men") { mensDiscus[d.year] = {} }

                    else if (d.game == "Discus Throw Women") { womensDiscus[d.year] = {} }
                    
                    // Populate countryData
                    
                    // If countryData already has that country 
                    if (countryData[d.country]) {
                        if (d.medal == 'gold') {
                            countryData[d.country].total += 1;
                            countryData[d.country].gold += 1;
                            if (countryData[d.country].byyear[d.year]) {
                                countryData[d.country].byyear[d.year].t +=1;
                                countryData[d.country].byyear[d.year].g +=1;
                            } else {
                                countryData[d.country].byyear[d.year] = {t:1, g:1, s:0, b:0};
                            }
                        } else if (d.medal == 'silver') {
                            countryData[d.country].total += 1;
                            countryData[d.country].silver += 1;
                            if (countryData[d.country].byyear[d.year]) {
                                countryData[d.country].byyear[d.year].t +=1;
                                countryData[d.country].byyear[d.year].s +=1;
                            } else {
                                countryData[d.country].byyear[d.year] = {t:1, g:0, s:1, b:0};
                            }
                        } else {
                            countryData[d.country].total += 1;
                            countryData[d.country].bronze += 1;
                            if (countryData[d.country].byyear[d.year]) {
                                countryData[d.country].byyear[d.year].t +=1;
                                countryData[d.country].byyear[d.year].b +=1;
                            } else {
                                countryData[d.country].byyear[d.year] = {t:1, g:0, s:0, b:1};
                            }
                        }
                    } else {
                        countryData[d.country] = {total: 0, gold: 0, silver: 0, bronze: 0, byyear:{}};
                    }
                })
                
                // Create object for every year's results (keys =  gold, silver and bronze )
                olympicData.forEach(function(d){
                    
                    if (d.game == "100M Men"){ olympicYearResults(mens100m, d); }
                    
                    if (d.game == "100M Women"){ olympicYearResults(womens100m, d); }

                    if (d.game == "200M Butterfly Men"){ olympicYearResults(mens200mFly, d); }
                    
                    if (d.game == "200M Butterfly Women"){ olympicYearResults(womens200mFly, d); }

                    if (d.game == "Discus Throw Men"){ olympicYearResults(mensDiscus, d); }
                    
                    if (d.game == "Discus Throw Women"){ olympicYearResults(womensDiscus, d); }
                    
                });
                
                // Add speeds to object: 100m / result
                for (year in mens100m){
                    mens100m[year].gold.speed = 100.0/mens100m[year].gold.result;
                    mens100m[year].silver.speed = 100.0/mens100m[year].silver.result;
                    mens100m[year].bronze.speed = 100.0/mens100m[year].bronze.result;
                };
                
                // Add speeds to 100m Womens object: 100m / result
                for (year in womens100m){
                    womens100m[year].gold.speed = 100.0/womens100m[year].gold.result;
                    womens100m[year].silver.speed = 100.0/womens100m[year].silver.result;
                    womens100m[year].bronze.speed = 100.0/womens100m[year].bronze.result;
                };

                // Add speeds to 200m Mens Butterfly object: 200m / result
                for (year in mens200mFly){
                    mens200mFly[year].gold.speed = 200.0/mens200mFly[year].gold.result;
                    mens200mFly[year].silver.speed = 200.0/mens200mFly[year].silver.result;
                    mens200mFly[year].bronze.speed = 200.0/mens200mFly[year].bronze.result;
                };

                // Add speeds to 200m Mens Butterfly object: 200m / result
                for (year in womens200mFly){
                    womens200mFly[year].gold.speed = 200.0/womens200mFly[year].gold.result;
                    womens200mFly[year].silver.speed = 200.0/womens200mFly[year].silver.result;
                    womens200mFly[year].bronze.speed = 200.0/womens200mFly[year].bronze.result;
                };

                // shows when page is first loaded
                plotTracks(mens100m);

                // show mens track 
                d3.select("#buttonTrackMen").on("click", function() {
                    svgTrack.selectAll("text").remove();
                    svgTrackGroup.selectAll("*").remove();
                    plotTracks(mens100m);
                });

                // show womens track
                d3.select("#buttonTrackWomen").on("click", function() {
                    svgTrack.selectAll("text").remove();
                    svgTrackGroup.selectAll("*").remove();
                    plotTracks(womens100m);
                });
                
                // show mens swim
                d3.select("#buttonPoolMen").on("click", function() {
                    svgPool.selectAll("text").remove();
                    svgPoolGroup.selectAll("*").remove();
                    plotPoolLanes(mens200mFly);
                });

                // show womens swim
                d3.select("#buttonPoolWomen").on("click", function() {
                    svgPool.selectAll("text").remove();
                    svgPoolGroup.selectAll("*").remove();
                    plotPoolLanes(womens200mFly);
                });

                // show mens discus
                d3.select("#buttonDiscusMen").on("click", function() {
                    svgDiscus.selectAll("text").remove();
                    svgDiscusGroup.selectAll("*").remove();
                    plotDiscusThrows(mensDiscus);
                });

                // show womens discus
                d3.select("#buttonDiscusWomen").on("click", function() {
                    svgDiscus.selectAll("text").remove();
                    svgDiscusGroup.selectAll("*").remove();
                    plotDiscusThrows(womensDiscus);
                });

                // only show track
                d3.select("#showTrack").on("click", function() {
                    svgTrack.selectAll("text").remove();
                    svgTrackGroup.selectAll("*").remove();
                    plotTracks(mens100m);
                    document.getElementById("trackViz").style.display = "inline";
                    document.getElementById("poolViz").style.display = "none";
                    document.getElementById("discusViz").style.display = "none";
                })

                // only show pool
                d3.select("#showPool").on("click", function() {
                    svgPool.selectAll("text").remove();
                    svgPoolGroup.selectAll("*").remove();
                    plotPoolLanes(mens200mFly);
                    document.getElementById("trackViz").style.display = "none";
                    document.getElementById("poolViz").style.display = "inline";
                    document.getElementById("discusViz").style.display = "none";
                })

                // only show discus
                d3.select("#showDiscus").on("click", function() {
                    svgDiscus.selectAll("text").remove();
                    svgDiscusGroup.selectAll("*").remove();
                    plotDiscusThrows(mensDiscus);
                    document.getElementById("trackViz").style.display = "none";
                    document.getElementById("poolViz").style.display = "none";
                    document.getElementById("discusViz").style.display = "inline";
                })

                plotCountries(countryData);
                
                
                d3.select("#dataSlider").on("input", function() {
                    updatePlot(+this.value);
                });
                
            });
                        
        </script>
    </p>
        
    <p id = "trackViz">

        <button id="buttonTrackMen"> Men </button>
        <button id="buttonTrackWomen"> Women </button>

        <script>
            
            var width = 1400, height = 600;

            var xTrackScale = d3.scaleLinear().domain([0,100]).range([100,1000]);
            var xTrackScale2 = d3.scaleLinear().domain([80,100]).range([100,1000]); // zoom into points

            var yScaleMen = d3.scaleLinear().domain([0,25]).range([490,90]);
            var yScaleWomen = d3.scaleLinear().domain([0,21]).range([490,90]);

            // Create SVG
            var svgTrack = d3.select("#trackViz")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

            var svgTrackGroup = svgTrack.append("g");
            
            // 100M Men's Record
            var recordTimeMen = 9.63; 
            var recordSpeedMen = 100/recordTimeMen;
            
            // 100M Women's Record
            var recordTimeWomen = 10.71;
            var recordSpeedWomen = 100/recordTimeWomen;
            
            function plotTracks(data) {
                
                var plottingData  = [];

                n = 1;

                var recordTime;

                if (data == mens100m) {
                    recordTime = recordTimeMen
                } else {
                    recordTime = recordTimeWomen } 
                
                for (y in data) {
                    
                    var bronzeDistance = data[y].bronze.speed*recordTime;
                    plottingData.push({game: data[y].bronze.game, start: 0, end: bronzeDistance,speed:data[y].bronze.speed, result: data[y].bronze.result, color: "orange", order:n, year: y, medal: "bronze", athlete: data[y].bronze.athlete, country: data[y].bronze.country});
                    
                    var silverDistance = data[y].silver.speed*recordTime;
                    plottingData.push({game: data[y].silver.game, start: 0, end: silverDistance, speed:data[y].silver.speed, result: data[y].silver.result, color: "grey", order: n, year: y, medal: "silver", athlete: data[y].silver.athlete, country: data[y].silver.country});
                    
                    var goldDistance = data[y].gold.speed*recordTime;
                    plottingData.push({game: data[y].gold.game, start: 0, end: goldDistance, speed:data[y].gold.speed, result: data[y].gold.result, color: "gold", order: n, year: y, medal: "gold", athlete: data[y].gold.athlete, country: data[y].gold.country });
                            
                    n++;
                }

                var yScale;

                if (data == mens100m) {
                    yScale = yScaleMen;
                } else {
                    yScale = yScaleWomen;
                }

                // Add track for each olympic year
                var raceTrack = svgTrackGroup.selectAll("g").data(plottingData).enter().append("rect");

                raceTrack.attr("width", 900).attr("height", function() {
                    if (data == mens100m) { return 14 }
                    else { return 17 }
                })
                .attr("x", 100).attr("y", function(d) {
                    if (data == mens100m) { return yScale(d.order) - 7 }
                    else { return yScale(d.order) - 17/2 }
                })
                .style("fill", "lightGrey")
                .style("opacity", .1);

                // Finish Line
                svgTrackGroup.append("rect")
                .attr("x", xTrackScale(100))
                .attr("y", function() {
                    if (data == mens100m) { return yScale(25) }
                    else { return yScale(21) }
                })
                .attr("width", 50)
                .attr("height", 400)
                .style("fill", "white")
                .style("stroke", "grey")
                .style("stroke-width", .5);

                svgTrackGroup.append("text").text("FINISH")
                .attr("x", -300)
                .attr("y", 1035)
                .attr("transform", "rotate(270)")
                .style("text-anchor", "middle")
                .style("font-size", 25)
                .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");

                // Add gold, bronze, and silver medal plots
                var circles = svgTrackGroup.selectAll("g").data(plottingData)
                .enter().append("circle");

                circles
                    .attr('class', 'track-circles')
                    .attr("cx", function(d) {return xScale(d.start)})
                    .attr("cy",function(d) {return yScale(d.order)})
                    .attr("r", 5)
                    .style("fill", function(d) {return d.color});

                circles.transition()
                .ease(d3.easeLinear)
                .duration(2000)
                    .attr('cx', function(d,i) { return xTrackScale(d.end) })
                .transition()
                .duration(1000)
                .transition()
                 .duration(4000)
                    .attr('cx', function(d,i) { return xTrackScale2(d.end) });


                // Add y-axis text: years
                var olympicYears = svgTrack.selectAll("g").data(plottingData).enter().append("text");

                olympicYears.text(function(d) {return d.year})
                .attr("x", 50)
                .attr("y", function(d) {return yScale(d.order)})
                .style("alignment-baseline", "middle")
                .style("font-size", 12)
                .style("font-weight", 200)
                .style("fill", "grey");

                // Add titles
                svgTrack.append("text").text(function() {
                    if (data == mens100m) { return "Olympic 100M Mens" }
                    else { return "Olympic 100M Womens" }
                })
                .attr("x", xTrackScale(0))
                .attr("y", 45)
                .style("font-size", 25)
                .style("font-weight", 600);

                svgTrack.append("text").text("If all Olympians raced the same race")
                .attr("x", xTrackScale(0))
                .attr("y", 70)
                .style("font-size", 16)
                .style("font-weight", 400);

                // Add x-axis text: distance in meters
                svgTrack.append("text").text("100m")
                .attr("x", xTrackScale(100))
                .attr("y", 500)
                .style("anchor", "middle");

                var eighty = svgTrack.append("text").text("80m")
                .attr("x", xTrackScale(80))
                .attr("y", 500)
                .style("anchor", "middle");

                var ninety = svgTrack.append("text").text("90m")
                .attr("x", xTrackScale(90))
                .attr("y", 500)
                .style("anchor", "middle");

                var fifty = svgTrack.append("text").text("50m")
                .attr("x", xTrackScale(50))
                .attr("y", 500)
                .style("anchor", "middle");

                eighty.transition()
                .duration(3000)
                    .attr('x', xTrackScale(80) )
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr('x', xTrackScale2(80) )

                ninety.transition()
                .duration(3000)
                    .attr('x', xTrackScale(90) )
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr('x', xTrackScale2(90) )

                fifty.transition()
                .duration(3000)
                    .attr('x', xTrackScale(50) )
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr('x', xTrackScale2(50) )
                    .style("opacity", -5);
                
                // Calls function for plotting descriptions
                if (data == mens100m) { plotHover(data, plottingData, circles, "track", "mens") }
                else { plotHover(data, plottingData, circles, "track", "womens") }
                
                // Calls function for filtering by country
                filterCountries(data, circles);
                
            }
            
            function plotHover(data, plottingData, objects, event, gender) {
                
                var countries = [];

                if (event == "track") {
                    svgGroup = svgTrackGroup;
                    xScale2 = xTrackScale2;
                    if (gender == "mens" ) { yScale = yScaleMen }
                    else { yScale = yScaleWomen }
                }
                else if (event == "pool") {
                    svgGroup = svgPoolGroup;
                    xScale2 = xPoolScale2;
                    if (gender == "mens" ) { yScale = yPoolScaleMen }
                    else { yScale = yPoolScaleWomen }
                }
                else {
                    svgGroup = svgDiscusGroup
                    xScale2 = xDiscusScale2;
                    if (gender == "mens" ) { yScale = yDiscusScaleMen }
                    else { yScale = yDiscusScaleWomen }
                }

                // Append the rectangles
                var rects = svgGroup.selectAll('g').data(plottingData).enter().append('rect');
                
                // Append the flag iamges
                var flags = svgGroup.selectAll('g').data(plottingData).enter().append('image');
                
                // Populate list of countries
                for (key in data) {
                    var c1 = data[key].gold.country;
                    if (countries.includes(c1) == false) {
                        countries.push(c1);
                    } 
                    var c2 = data[key].silver.country;
                    if (countries.includes(c2) == false) {
                        countries.push(c2); }
                    var c3 = data[key].bronze.country;
                    if (countries.includes(c3) == false) {
                        countries.push(c3);
                    }
                }
                // console.log(countries);
                
                // Append the text onto the rectangles
                var texts = svgGroup.selectAll('g').data(plottingData).enter().append('text');
                
                rects.attr('id', function(d) {return d.medal+d.year+d.game})
                    .attr('x', function(d) {return xScale2(d.end)-75})
                    .attr('rx', '6px')
                    .attr('ry', '6px')
                    .attr('width', '155px')
                    .attr('height', '70px')
                    .style('fill', function(d) {
                        if (d.medal == "gold") { return "gold" }
                        else if (d.medal == "silver") { return "grey" }
                        else { return "orange" }
                    })
                    .style('display', 'none');
                
                
                flags.attr('id', function(d) {return d.medal+d.year+d.game+'flag'})
                    .attr('xlink:href', function (d) {return 'img/flags/'+d.country+'.svg'})
                    .attr('x', function (d) {return xScale2(d.end)-65})
                    .attr('width', '25px')
                    .style('display','none');

                texts.attr('id', function(d) {return d.medal+d.year+d.game+'text'})
                    .attr('class', 'hover-athlete')
                    .attr('x', function(d) {return xScale2(d.end)-30})
                    .attr('width', '145px')
                    .attr('height', '65px')
                    // .style('fill', 'indianred')
                    .style('display', 'none')
                    .style('word-breal', 'all')
                    .text(function(d) {
                        var ath = d.athlete.split(' ');
                        var lastname = ath[1].charAt(0) + ath[1].slice(1).toLowerCase();
                        ath[1] = lastname;
                        return ath[0]+' '+ath[1];
                    });
                
                texts.append('tspan')
                    .attr('class', 'hover-desc')
                    .attr('x', function(d) {return xScale2(d.end)-30})
                    .attr('dy', '12px')
                    .text(function(d) {
                        return 'Country: '+d.country;
                    });

                
                if (event == "discus") {
                    texts.append('tspan')
                        .attr('class', 'hover-desc')
                        .attr('x', function (d) {return xScale2(d.end)-30})
                        .attr('dy', '12px')
                        .text(function(d) {
                            return 'Distance: '+d.result.toFixed(2)+' m';
                        }); 
                } else {    

                    texts.append('tspan')
                        .attr('class', 'hover-desc')
                        .attr('x', function (d) {return xScale2(d.end)-30})
                        .attr('dy', '12px')
                        .text(function(d) {
                            return 'Time: '+d.result.toFixed(2)+ ' s';
                    }); 

                    texts.append('tspan')
                        .attr('class', 'hover-desc')
                        .attr('x', function (d) {return xScale2(d.end)-30})
                        .attr('dy', '12px')
                        .text(function(d) {
                            return 'Speed: '+d.speed.toFixed(2)+' m/s';
                        }); 
                } 
                
                
                objects
                    .on('mouseenter', function(d) {
                    
                        var id = d.medal+d.year+d.game;
                        // console.log('click');
                        // console.log('#hover'+id);
                        // console.log(d3.select('#hover'+id));
                    
                        // If circles on upper half of graph
                        if (d.year >= 1968) {
                            rects.attr('y', function(d) {return yScale(d.order)+15});
                            flags.attr('y', function(d) {return yScale(d.order)+25});
                            texts.attr('y', function(d) {return yScale(d.order)+35});
                        } else { 
                            // if (d.year <= 1964)
                            rects.attr('y', function (d) {return yScale(d.order)-70-15});
                            flags.attr('y', function(d) {return yScale(d.order)-70-5});
                            texts.attr('y', function(d) {return yScale(d.order)-70+5});
                        }
                    
                        d3.select('#'+id).style('display', 'inline');
                        d3.select('#'+id+'flag').style('display', 'inline');
                        d3.select('#'+id+'text').style('display', 'inline');
                })
                .on('mouseleave', function(d) {
                    var id = d.medal+d.year+d.game;
                    d3.select('#'+id).style('display', 'none');
                    d3.select('#'+id+'flag').style('display', 'none');
                    d3.select('#'+id+'text').style('display', 'none');
                });
            }

        </script>
        
        <!-- <script>
            // Legend: circle colors
            var goldMedal = svgTrackGroup.append("circle")
                .attr("cx", 1150).attr("cy", 150)
                .attr("r", 8)
                .style("fill", "gold");
            
            var silverMedal = svgTrackGroup.append("circle")
                .attr("cx", 1200).attr("cy", 150)
                .attr("r", 8)
                .style("fill", "grey");
            
            var bronzeMedal = svgTrackGroup.append("circle")
                .attr("cx", 1250).attr("cy", 150)
                .attr("r",8)
                .style("fill", "orange");
            
            
            // Record Holder    
            var recordHolder = svgGroup.append("text")
                .text("Record: 9.63 seconds")
                .attr("x", 1100).attr("y", 200);
            
            // Filter: by countries
            function filterCountries(data, objects) {
                // Variables
                var counts = {};
                var count = 0;
                
                // Append the flag iamges
                var filter = svgGroup.selectAll('g').data(plottingData).enter().append('image');
                
                filter
                    .attr('xlink:href', function (d) {
                        if (d.country in counts == false) {
                            counts[d.country] = [count, 1];
                            count++;
                            // console.log(counts);
                            // console.log('Entering');
                            return 'img/flags/'+d.country+'.svg';
                        } else {
                            counts[d.country][1] ++;
                        }
                        
                    })
                    .attr('x', function(d) {
                        if (counts[d.country][0] <= 3) {
                            return 1050;
                        } else if (counts[d.country][0] > 3 && counts[d.country][0] <= 7) {
                            return 1125;
                        } else if (counts[d.country][0] > 7 && counts[d.country][0] <= 11) {
                            return 1200;
                        } else {
                            return 1275;
                        } 
                    })
                    .attr('y', function(d) {
                        var increment;
                        if (counts[d.country][0] <= 3) {
                            increment = counts[d.country][0];
                        } else if (counts[d.country][0] > 3 && counts[d.country][0] <= 7) {
                            increment = counts[d.country][0] - 4;
                        } else if (counts[d.country][0] > 7 && counts[d.country][0] <= 11) {
                            increment = counts[d.country][0] - 8;
                        } else {
                            increment = counts[d.country][0] - 12;
                        }
                        return 250+increment*35;
                        
                    })
                    .attr('width', '25px')
                    .on('mousedown', function(d) {
                        var click = d.country;
                        svgGroup.selectAll('.track-circles')
                            .style('opacity', function(d) {
                                console.log('Entering circles');
                                if (d.country != click) {
                                    return '0.1';
                                }
                            })
                    })
                    .on('mouseup', function(d) {
                        svgGroup.selectAll('.track-circles').style('opacity', 1);
                    })
                    .style('cursor', 'pointer')
                    .style('display', function(d) {
                        if (d.country == 'POR') { return 'none'; }
                    });        
                
                var labels = svgGroup.selectAll('g').data(plottingData).enter().append('text');
                var countryLabels = [];
                
                labels
                    .attr('class', 'hover-athlete')
                    .attr('x', function(d) {
                        if (counts[d.country][0] <= 3) {
                                return 1050+35;
                            } else if (counts[d.country][0] > 3 && counts[d.country][0] <= 7) {
                                return 1125+35;
                            } else if (counts[d.country][0] > 7 && counts[d.country][0] <= 11) {
                                return 1200+35;
                            } else {
                                return 1275+35;
                            }
                    })
                    .attr('y', function(d) {
                        var increment;
                        if (counts[d.country][0] <= 3) {
                            increment = counts[d.country][0];
                        } else if (counts[d.country][0] > 3 && counts[d.country][0] <= 7) {
                            increment = counts[d.country][0] - 4;
                        } else if (counts[d.country][0] > 7 && counts[d.country][0] <= 11) {
                            increment = counts[d.country][0] - 8;
                        } else {
                            increment = counts[d.country][0] - 12;
                        }
                        return 250+increment*35 + 18;
                    })
                    // .attr('width', '145px')
                    // .attr('height', '65px')
                    // .style('fill', 'indianred')
                    .text(function(d) {
                        if (countryLabels.includes(d.country) == false) {
                            countryLabels.push(d.country);
                            return d.country;    
                        } 
                    })
                    .style('display', function(d) {
                        if (d.country == 'POR') { return 'none'; }
                    });
            }
        </script> -->
    </p>

    <p id="poolViz">

        <button id="buttonPoolMen"> Men </button>
        <button id="buttonPoolWomen"> Women </button>

        <script>
            var xPoolScale = d3.scaleLinear().domain([0,200]).range([100,1000]);

            var xPoolScale2 = d3.scaleLinear().domain([150,200]).range([100,1000]); // zoom into points

            var yPoolScaleMen = d3.scaleLinear().domain([0,16]).range([490,90]);
            var yPoolScaleWomen = d3.scaleLinear().domain([0,13]).range([490,90]);

            // Create SVG
            var svgPool = d3.select("#poolViz")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

            var svgPoolGroup = svgPool.append("g");
            
            // 200M Butterfly Men's Record
            var recordTimeFlyMen = 112.03;
            var recordSpeedFlyMen = 200/recordTimeFlyMen;

            // 200M Butterfly Women's Record
            var recordTimeFlyWomen = 124.06;
            var recordSpeedFlyWomen = 200/recordTimeFlyWomen;

            function plotPoolLanes(data) {
                
                var plottingData  = []; // Array of objects
    
                n = 1;
                
                var recordTimeFly;

                if (data == mens200mFly) {
                    recordTimeFly = recordTimeFlyMen
                } else {
                    recordTimeFly = recordTimeFlyWomen } 

                for (y in data) {

                    var bronzeDistance = data[y].bronze.speed*recordTimeFly;
                    plottingData.push({game: data[y].bronze.game, start: 0, end: bronzeDistance,speed:data[y].bronze.speed, result: data[y].bronze.result, color: "orange", order:n, year: y, medal: "bronze", athlete: data[y].bronze.athlete, country: data[y].bronze.country});
                    
                    var silverDistance = data[y].silver.speed*recordTimeFly;
                    plottingData.push({game: data[y].silver.game, start: 0, end: silverDistance, speed:data[y].silver.speed, result: data[y].silver.result, color: "grey", order: n, year: y, medal: "silver", athlete: data[y].silver.athlete, country: data[y].silver.country});
                    
                    var goldDistance = data[y].gold.speed*recordTimeFly;
                    plottingData.push({game: data[y].gold.game, start: 0, end: goldDistance, speed:data[y].gold.speed, result: data[y].gold.result, color: "gold", order: n, year: y, medal: "gold", athlete: data[y].gold.athlete, country: data[y].gold.country });

                    n++;     
                }

                var yPoolScale;

                if (data == mens200mFly) {
                    yPoolScale = yPoolScaleMen;
                } else {
                    yPoolScale = yPoolScaleWomen;
                }

                // Add track for each olympic year
                var poolLanes = svgPoolGroup.selectAll("g").data(plottingData).enter().append("rect");

                poolLanes.attr("width", 900).attr("height", function() {
                    if (data == mens200mFly) { return 24 }
                    else { return 30 }
                })
                .attr("x", 100).attr("y", function(d) {
                    if (data == mens200mFly) { return yPoolScale(d.order) - 12 }
                    else { return yPoolScale(d.order) - 15 }
                })
                .style("fill", "skyblue")
                .style("opacity", .1);

                // Finish Line
                svgPoolGroup.append("rect")
                .attr("x", xPoolScale(200))
                .attr("y", function() {
                    if (data == mens200mFly) { return yPoolScale(16) }
                    else { return yPoolScale(13) }
                })
                .attr("width", 50)
                .attr("height", 400)
                .style("fill", "white")
                .style("stroke", "grey")
                .style("stroke-width", .5);

                svgPoolGroup.append("text").text("FINISH")
                .attr("x", -300)
                .attr("y", 1035)
                .attr("transform", "rotate(270)")
                .style("text-anchor", "middle")
                .style("font-size", 25)
                .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");

                // Add gold, bronze, and silver medal plots
                var circles = svgPoolGroup.selectAll("g").data(plottingData)
                .enter().append("circle");

                circles.attr("cx", function(d) {return xPoolScale(d.start)})
                .attr("cy",function(d) {return yPoolScale(d.order)})
                .attr("r", 5)
                .style("fill", function(d) {return d.color});

                circles.transition()
                .duration(2000)
                    .ease(d3.easeLinear)
                    .attr('cx', function(d,i) { return xPoolScale(d.end) })
                .transition()
                    .duration(1000)
                .transition()
                .duration(4000)
                    .attr('cx', function(d,i) { return xPoolScale2(d.end) });


                // Add y-axis text: years
                var olympicYears = svgPool.selectAll("g").data(plottingData).enter().append("text");

                olympicYears.text(function(d) {return d.year})
                .attr("x", 50)
                .attr("y", function(d) {return yPoolScale(d.order)})
                .style("alignment-baseline", "middle")
                .style("font-size", 12)
                .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");


                // Add titles
                svgPool.append("text").text(function() {
                    if (data == mens200mFly) { return "Olympic 200M Butterfly Mens" }
                    else { return "Olympic 200M Butterfly Womens" }
                })
                .attr("x", xPoolScale(0))
                .attr("y", 45)
                .style("font-size", 25)
                .style("font-family", "Roboto")
                .style("font-weight", 600);

                // Add x-axis text: distance in meters
                svgPool.append("text").text("200m")
                .attr("x", xPoolScale(200))
                .attr("y", 500)
                .style("anchor", "middle");

                var hundred = svgPool.append("text").text("100m")
                .attr("x", xPoolScale(100))
                .attr("y", 500)
                .style("anchor", "middle");

                var oneFifty = svgPool.append("text").text("150m")
                .attr("x", xPoolScale(150))
                .attr("y", 500)
                .style("anchor", "middle");

                var oneSeventyFive = svgPool.append("text").text("175m")
                .attr("x", xPoolScale(175))
                .attr("y", 500)
                .style("anchor", "middle");


                hundred.transition()
                .duration(3000)
                    .attr('x', xPoolScale(100) )
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr('x', xPoolScale2(100) )
                    .style("opacity", -5)

                oneFifty.transition()
                .duration(3000)
                    .attr('x', xPoolScale(150) )
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr('x', xPoolScale2(150) )

                oneSeventyFive.transition()
                .duration(3000)
                    .attr('x', xPoolScale(175) )
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr('x', xPoolScale2(175) )

                if (data == mens200mFly) { plotHover(data, plottingData, circles, "pool", "mens") }
                else { plotHover(data, plottingData, circles, "pool", "womens") }
                
            }

        </script>

    </p>

    <p id="discusViz">

        <button id="buttonDiscusMen"> Men </button>
        <button id="buttonDiscusWomen"> Women </button>

        <script>
        
            var xDiscusScale = d3.scaleLinear().domain([0,70]).range([100,1000]);

            var xDiscusScale2 = d3.scaleLinear().domain([25,70]).range([100,1000]); // zoom into points

            var yDiscusScaleMen = d3.scaleLinear().domain([0,20]).range([490,90]);
            var yDiscusScaleWomen = d3.scaleLinear().domain([0,18]).range([490,90]);

            // Create SVG
            var svgDiscus = d3.select("#discusViz")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

            var svgDiscusGroup = svgDiscus.append("g");

            function plotDiscusThrows(data) {
                
                var plottingData  = []; // Array of objects
    
                n = 1;
                
                for (y in data) {

                    plottingData.push({game: data[y].bronze.game, start: 0, end: data[y].bronze.result, result: data[y].bronze.result, color: "orange", order:n, year: y, medal: "bronze", athlete: data[y].bronze.athlete, country: data[y].bronze.country});
                    
                    plottingData.push({game: data[y].silver.game, start: 0, end: data[y].silver.result, result: data[y].silver.result, color: "grey", order: n, year: y, medal: "silver", athlete: data[y].silver.athlete, country: data[y].silver.country});
                    
                    plottingData.push({game: data[y].gold.game, start: 0, end: data[y].gold.result, result: data[y].gold.result, color: "gold", order: n, year: y, medal: "gold", athlete: data[y].gold.athlete, country: data[y].gold.country });

                    n++;     
                }

                var yDiscusScale;

                if (data == mensDiscus) {
                    yDiscusScale = yDiscusScaleMen;
                } else {
                    yDiscusScale = yDiscusScaleWomen;
                }

                // Add track for each olympic year
                var discusPath = svgDiscusGroup.selectAll("g").data(plottingData).enter().append("rect");

                discusPath.attr("width", 900).attr("height", function() {
                    if (data == mensDiscus) { return 19 }
                    else { return 21 }
                })
                .attr("x", 100).attr("y", function(d) {
                    if (data == mensDiscus) { return yDiscusScale(d.order) - 19/2 }
                    else { return yDiscusScale(d.order) - 21/2 }
                })
                .style("fill", "lightgreen")
                .style("opacity", .1);

                // Finish Line
                svgDiscusGroup.append("rect")
                .attr("x", xDiscusScale(70))
                .attr("y", function() {
                    if (data == mensDiscus) { return yDiscusScale(20) }
                    else { return yDiscusScale(18) }
                })
                .attr("width", 50)
                .attr("height", 400)
                .style("fill", "white")
                .style("stroke", "grey")
                .style("stroke-width", .5);

                svgDiscusGroup.append("text").text("FINISH")
                .attr("x", -300)
                .attr("y", 1035)
                .attr("transform", "rotate(270)")
                .style("text-anchor", "middle")
                .style("font-size", 25)
                .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");

                // paths that circles will move along
                var motionPaths = svgDiscusGroup.selectAll("g").data(plottingData)
                .enter().append("path")
                .attr("d", function(d) {
                    // M xStart yStart Q xControl yControl xEnd yEnd
                    return "M " + xDiscusScale(d.start) + " " + yDiscusScale(d.order) +  
                            " Q " + xDiscusScale(d.result/2) + " " + (yDiscusScale(d.order) - d.result * 3.5) + 
                            " " +  xDiscusScale(d.result) + " " + yDiscusScale(d.order);
                })
                .attr("id", function(d) { return d.color + d.year }) // e.g. "gold2016"
                .attr("class", "trajectory")
                .style("fill", "none")
                .style("stroke", "lightgrey")
                
                animateLines();
                
                // Add gold, bronze, and silver medal circles
                var circles = svgDiscusGroup.selectAll("g").data(plottingData)
                .enter().append("circle");

                circles.attr("cx", function(d) {return xDiscusScale(d.start)})
                .attr("cy",function(d) {return yDiscusScale(d.order)})
                .attr("class", "firstCircles")
                .attr("r", 5)
                .style("fill", function(d) {return d.color});

                // move circles along path
                circles.transition()
                    .duration(3000)
                    .ease(d3.easeLinear)
                    .attrTween("transform", function(d) {
                        var path = d3.select("#" + d.color + d.year);
                        return translateAlong(path.node());
                    })

                // remove first circles
                svgDiscusGroup.selectAll("circle").transition()
                .delay(3250)
                .on('end', function(d) {
                    svgDiscusGroup.selectAll(".firstCircles").remove()
                })

                // secretly plot circles at ending points
                var secondCircles = svgDiscusGroup.selectAll("g").data(plottingData)
                .enter().append("circle");

                secondCircles.attr("cx", function(d) {return xDiscusScale(d.end)})
                .attr("cy",function(d) {return yDiscusScale(d.order)})
                .attr("r", 5)
                .style("fill", function(d) {return d.color})
                .style("opacity", 0)

                // make circles visible and then rescale
                secondCircles.transition()
                    .delay(3500)
                    .duration(1)
                    .style("opacity", 1)
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr("cx", function(d) {
                        return xDiscusScale2(d.end)
                    })

                function animateLines() {
                    d3.selectAll(".trajectory").each(function(d,i) {
                        var totalLength = d3.select("#" + d.color + d.year).node().getTotalLength();
                        d3.select("#" + d.color + d.year).attr("stroke-dasharray", totalLength + " " + totalLength)
                        .attr("stroke-dashoffset", totalLength)
                        .transition()
                            .duration(3000)
                            .ease(d3.easeLinear)
                            .attr("stroke-dashoffset", 0)
                            .style("stroke-width", 1)
                        .transition() // make lines disappear
                            .duration(1000)
                            .style("opacity", 0) 

                    })
                }

                function translateAlong(path) {
                    var l = path.getTotalLength();
                    return function(t) {
                        var p = path.getPointAtLength(t * l);
                        var init = path.getPointAtLength(0)
                        return "translate(" + (p.x - init.x) + "," + (p.y - init.y) + ")";
                    };
                } 

                // Add y-axis text: years
                var olympicYears = svgDiscus.selectAll("g").data(plottingData).enter().append("text");

                olympicYears.text(function(d) {return d.year})
                .attr("x", 50)
                .attr("y", function(d) {return yDiscusScale(d.order)})
                .style("alignment-baseline", "middle")
                .style("font-size", 12)
                .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");

                // Add titles
                svgDiscus.append("text").text(function() {
                    if (data == mensDiscus) { return "Olympic Discus Throw Mens" }
                    else { return "Olympic Discus Throw Womens" }
                })
                .attr("x", xDiscusScale(0))
                .attr("y", 45)
                .style("font-size", 25)
                .style("font-family", "Roboto")
                .style("font-weight", 600);

                // Add x-axis text: distance in meters
                svgDiscus.append("text").text("70m")
                .attr("x", xDiscusScale(70))
                .attr("y", 500)
                .style("anchor", "middle");

                var fifty = svgDiscus.append("text").text("50m")
                .attr("x", xDiscusScale(50))
                .attr("y", 500)
                .style("anchor", "middle");

                var twentyFive = svgDiscus.append("text").text("25m")
                .attr("x", xDiscusScale(25))
                .attr("y", 500)
                .style("anchor", "middle");

                twentyFive.transition()
                .duration(4000)
                    .attr('x', xDiscusScale(25) )
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr('x', xDiscusScale2(25) )

                fifty.transition()
                .duration(4000)
                    .attr('x', xDiscusScale(50) )
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr('x', xDiscusScale2(50) )

                if (data == mensDiscus) { plotHover(data, plottingData, secondCircles, "discus", "mens") }
                else { plotHover(data, plottingData, secondCircles, "discus", "womens") }

            }

        </script>

    </p>
    </div>
    
    <div id='plotCountries'></div>
    <script>
        // Country data visualization
        
        // Create SVG
        var svgCountry = d3.select('#plotCountries').append("svg")
            .attr("width", 1400)
            .attr("height", 2300);
        // var svgCountryGroup = svgCountry.append('g');
        
        // Create country array
        var cData = [];
        
        // Append country flags
        function plotCountries(data) {
            
            // For each country in data
            var counter = 0;
            for (c in data) {
                
                // Populate cData array
                cData.push({country: c, total: data[c].total, gold: data[c].gold, silver: data[c].silver, bronze: data[c].bronze, byyear: data[c].byyear})
                
                // Create a 'g' for each country
                var countryGroup = svgCountry.append('g').data(cData);
                
                // Append the flag iamges
                var countries = countryGroup.append('image');
                
                countries.attr('id', ''+counter+c)
                    .attr('xlink:href', function () {
                        if (c=='EUN' || c=='None') {
                            return ;
                        } else {
                            return 'img/flags/'+c+'.svg';
                        }  
                    })
                    .attr('x', '50px')
                    .attr('y', 50+35*counter)
                    .attr('width', '25px');
                
                // Append the country names
                var cNames = countryGroup.append('text');
                
                cNames
                    .attr('class', 'hover-athlete')
                    .attr('x', '90px')
                    .attr('y', 68+35*counter)
                    .text(c);
                
                // Append the years
                for (y=0; y<31; y++) {
                    var countryYears = countryGroup.append('rect')
                        .attr('x', 150+15*y)
                        .attr('y', 60+35*counter)
                        .attr('width', '10px')
                        .attr('height', '10px')
                        .attr('fill', function(d) {
                        
                            var yr = 1896+y*4;
                        
                            // If country won an award that year
                            if (data[c].byyear[yr]) {
                                
                                // If country won more than one award that year
//                                var n = data[c].byyear[yr].t;
//                                console.log(n);
//                                for (z=0; z<n; z++) {
//                                    countryYears.append('rect')
//                                        .attr('x', 150+15*y)
//                                        .attr('y', 60+50*counter - z*15)
//                                        .attr('width', '10px')
//                                        .attr('height', '10px')
//                                        .attr('fill', 'salmon');
//                                        // .style('display', 'none');
//                                } 
                                
                                return 'salmon';
                            } else {
                                return 'lightgray';
                            }
                        })
                        .on('mouseenter', function(d) {
                            // console.log(d);
                        });
                    
                // Hover over the years
                // yrs.on('mouseenter', function(d) {
                    // console.log('mouseeenter');
                    // console.log(d);
                    
                    // d3.select('#'+c+'squares').style('display', 'inline');
                //});
                    
                }
                counter += 1;
            
            }
            
            // On hover
//            d3.selectAll(countryGroup)
//                .on('click', function(d) {
//                console.log('hover');
//            })
        }
        
        
        
    </script>
    
</body>

</html>