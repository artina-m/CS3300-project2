<!DOCTYPE html>
<html>
<head>
    <title>INFO 3300 Project 2 </title>
    <meta name="description" content="INFO 3300 Project 2">
    <meta charset="utf-8">
    
    <!-- Load d3, topojson & AJAX -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="http://d3js.org/topojson.v2.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script><script src="https://d3js.org/d3.v4.min.js"></script>
    
    <link rel = "stylesheet" type="text/css" href = "style.css">
    
    <!-- Font -->
        <!--    extra-light 200
                light 300
                regular 400
                semi-bold 600
                bold 700
                extra-bold 800
                black 900-->
    <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
</head>

<body>
    <h1>The Olympians</h1>
    <h2>We asked ourselves, "what if all Olympians raced the same race?"</h2>
    
    <div class='br'></div>
    
    <h3 class='title'>Visualization</h3>
    
    <div class = 'filter-game'>
        <button id="showTrack" class="seg-nav left"><h4>100M Track</h4></button>
        <button id="showPool" class="seg-nav"><h4>200M Butterfly</h4></button>
        <button id="showDiscus" class="seg-nav right"><h4>Discus Throw</h4></button>
    </div>
    
    <div class = 'filter-gender'>
        <button id="buttonTrackMen" class='seg-nav left'><h4>Men</h4></button>
        <button id="buttonTrackWomen" class='seg-nav right'><h4>Women</h4></button>
        <button id="buttonPoolMen" class='seg-nav left' style='display: none;'><h4>Men</h4></button>
        <button id="buttonPoolWomen" class='seg-nav right' style='display: none;'><h4>Women</h4></button>
        <button id="buttonDiscusMen" class='seg-nav left' style='display: none;'><h4>Men</h4></button>
        <button id="buttonDiscusWomen" class='seg-nav right' style='display: none;'><h4>Women</h4></button>
    </div>
    
    <div>
    <p>     
        <script>
            // Olympic Games of interest
            var mens100m  = {}; // result (time), athlete, country, speed
            var womens100m  = {};
            var mens200mFly = {}; 
            var womens200mFly = {};
            var mensDiscus = {};
            var womensDiscus = {};
            
            // Olympic Sports of interest
            var longJumpM = {};     // Long Jump
            var longJumpW = {};
            var hammerM = {};       // Hammer Throw
            var hammerW = {};   
            var freestyleM = {};    // 400m Free Style
            var freestyleW = {};
            var hurdlesM = {};      // Hurdles
            var hurdlesW = {}; 
            var shotPutM = {};      // Shot Put
            var shotPutW = {};
            var tripleJumpM = {};   // Triple Jump
            var tripleJumpW = {};
            var trackM = {};        // 100m Track
            var trackW = {};
            var butterflyM = {};    // 200m Butterfly
            var butterflyW = {};
            var discusM = {};       // Discus Throw
            var discusW = {};
            var highJumpM = {};     // High Jump
            var highJumpW = {};

            // Olympic Games by country
            // key: country
            // data: # medals, # gold, # silver, # bronze
            // data: [year: # medals, # gold, # bronze]
            var countryData = {};
            
            d3.queue()
            .defer(d3.csv, "olympicData.csv", parseLine)
            .defer(d3.csv, "OlympicRegression.csv", parseLine2)
            .await(createVisualization);
            
            function createVisualization(error, file1, file2){
                
                createAnimation(file1);
                
                createCharts(file2);
                
            }
            
            function parseLine2(line) {
                return {
                    game: line["Game"],
                    year: line["Year"],
                    medal: line["Medal"],
                    result: (line["Result"]),
                    country: line["Country"],
                    athlete: line["Athlete"]
                }
            }
            
            
            function parseLine(line) {
                var csvLine = {
                    game: line["Game"],
                    year: line["Year"],
                    medal: line["Medal"],
                    result: line["Result"],
                    country: line["Country"],
                    athlete: line["Athlete"]
                }
                if (csvLine.game == "200M Butterfly Men" || csvLine.game == "200M Butterfly Women") {
                    var time = csvLine.result.replace(/^0+(?!\.|$)/, ''); // remove leading zeros of time result e.g. "01:55.35"
                    time = Number(time.charAt(0)) * 60 + Number(time.substr(2)); // # of minutes * 60 seconds + seconds.milliseconds
                    csvLine.result = time;
                } else {
                    csvLine.result = Number(csvLine.result);
                }
                return csvLine;
            }
            
            // Update the data object olympicResults to include new results
            function olympicGoldResults (olympicResults, d){
                olympicResults[d.year] = {result: d.result, athlete: d.athlete, country: d.country, game: d.game};
            };
            
            // Create objects for gold, silver, and bronze results.
            // Update the data object olympicResults to include new results
            function olympicYearResults (olympicResults, d){
                var game = (d.game).replace(/\s/g, '').toLowerCase();
                if (d.medal == "gold"){
                    olympicResults[d.year].gold = {game: game, result: d.result, athlete: d.athlete, country: d.country};
                }
                if (d.medal == "silver"){
                    olympicResults[d.year].silver = {game: game, result: d.result, athlete: d.athlete, country: d.country};
                }
                if (d.medal == "bronze"){
                    olympicResults[d.year].bronze = {game: game, result: d.result, athlete: d.athlete, country: d.country};
                }
            }    
            
            function createAnimation(data){
                olympicData = data;
                
                // Create object for each olympic game (key = year)
                olympicData.forEach(function(d){
                    
                    if (d.game == "100M Men"){ mens100m[d.year]= {} }
                    
                    else if (d.game == "100M Women") { womens100m[d.year] = {} }

                    else if (d.game == "200M Butterfly Men") { mens200mFly[d.year] = {} }

                    else if (d.game == "200M Butterfly Women") { womens200mFly[d.year] = {} }

                    else if (d.game == "Discus Throw Men") { mensDiscus[d.year] = {} }

                    else if (d.game == "Discus Throw Women") { womensDiscus[d.year] = {} }
                    
                    // Populate countryData
                    
                    // If countryData already has that country 
                    if (countryData[d.country]) {
                        if (d.medal == 'gold') {
                            countryData[d.country].total += 1;
                            countryData[d.country].gold += 1;
                            if (countryData[d.country].byyear[d.year]) {
                                countryData[d.country].byyear[d.year].t +=1;
                                countryData[d.country].byyear[d.year].g +=1;
                            } else {
                                countryData[d.country].byyear[d.year] = {t:1, g:1, s:0, b:0};
                            }
                        } else if (d.medal == 'silver') {
                            countryData[d.country].total += 1;
                            countryData[d.country].silver += 1;
                            if (countryData[d.country].byyear[d.year]) {
                                countryData[d.country].byyear[d.year].t +=1;
                                countryData[d.country].byyear[d.year].s +=1;
                            } else {
                                countryData[d.country].byyear[d.year] = {t:1, g:0, s:1, b:0};
                            }
                        } else {
                            countryData[d.country].total += 1;
                            countryData[d.country].bronze += 1;
                            if (countryData[d.country].byyear[d.year]) {
                                countryData[d.country].byyear[d.year].t +=1;
                                countryData[d.country].byyear[d.year].b +=1;
                            } else {
                                countryData[d.country].byyear[d.year] = {t:1, g:0, s:0, b:1};
                            }
                        }
                    } else {
                        countryData[d.country] = {total: 0, gold: 0, silver: 0, bronze: 0, byyear:{}};
                    }
                })
                
                // Create object for every year's results (keys =  gold, silver and bronze )
                olympicData.forEach(function(d){
                    
                    if (d.game == "100M Men"){ olympicYearResults(mens100m, d); }
                    
                    if (d.game == "100M Women"){ olympicYearResults(womens100m, d); }

                    if (d.game == "200M Butterfly Men"){ olympicYearResults(mens200mFly, d); }
                    
                    if (d.game == "200M Butterfly Women"){ olympicYearResults(womens200mFly, d); }

                    if (d.game == "Discus Throw Men"){ olympicYearResults(mensDiscus, d); }
                    
                    if (d.game == "Discus Throw Women"){ olympicYearResults(womensDiscus, d); }
                    
                });
                
                // Add speeds to object: 100m / result
                for (year in mens100m){
                    mens100m[year].gold.speed = 100.0/mens100m[year].gold.result;
                    mens100m[year].silver.speed = 100.0/mens100m[year].silver.result;
                    mens100m[year].bronze.speed = 100.0/mens100m[year].bronze.result;
                };
                
                // Add speeds to 100m Womens object: 100m / result
                for (year in womens100m){
                    womens100m[year].gold.speed = 100.0/womens100m[year].gold.result;
                    womens100m[year].silver.speed = 100.0/womens100m[year].silver.result;
                    womens100m[year].bronze.speed = 100.0/womens100m[year].bronze.result;
                };

                // Add speeds to 200m Mens Butterfly object: 200m / result
                for (year in mens200mFly){
                    mens200mFly[year].gold.speed = 200.0/mens200mFly[year].gold.result;
                    mens200mFly[year].silver.speed = 200.0/mens200mFly[year].silver.result;
                    mens200mFly[year].bronze.speed = 200.0/mens200mFly[year].bronze.result;
                };

                // Add speeds to 200m Mens Butterfly object: 200m / result
                for (year in womens200mFly){
                    womens200mFly[year].gold.speed = 200.0/womens200mFly[year].gold.result;
                    womens200mFly[year].silver.speed = 200.0/womens200mFly[year].silver.result;
                    womens200mFly[year].bronze.speed = 200.0/womens200mFly[year].bronze.result;
                };

                // shows when page is first loaded
                plotTracks(mens100m);

                // show mens track 
                d3.select("#buttonTrackMen").on("click", function() {
                    svgTrack.selectAll("text").remove();
                    svgTrackGroup.selectAll("*").remove();
                    plotTracks(mens100m);
                });

                // show womens track
                d3.select("#buttonTrackWomen").on("click", function() {
                    svgTrack.selectAll("text").remove();
                    svgTrackGroup.selectAll("*").remove();
                    plotTracks(womens100m);
                });
                
                // show mens swim
                d3.select("#buttonPoolMen").on("click", function() {
                    svgPool.selectAll("text").remove();
                    svgPoolGroup.selectAll("*").remove();
                    plotPoolLanes(mens200mFly);
                });

                // show womens swim
                d3.select("#buttonPoolWomen").on("click", function() {
                    svgPool.selectAll("text").remove();
                    svgPoolGroup.selectAll("*").remove();
                    plotPoolLanes(womens200mFly);
                });

                // show mens discus
                d3.select("#buttonDiscusMen").on("click", function() {
                    svgDiscus.selectAll("text").remove();
                    svgDiscusGroup.selectAll("*").remove();
                    plotDiscusThrows(mensDiscus);
                });

                // show womens discus
                d3.select("#buttonDiscusWomen").on("click", function() {
                    svgDiscus.selectAll("text").remove();
                    svgDiscusGroup.selectAll("*").remove();
                    plotDiscusThrows(womensDiscus);
                });

                // only show track
                d3.select("#showTrack").on("click", function() {
                    svgTrack.selectAll("text").remove();
                    svgTrackGroup.selectAll("*").remove();
                    plotTracks(mens100m);
                    document.getElementById("trackViz").style.display = "inline";
                    document.getElementById("poolViz").style.display = "none";
                    document.getElementById("discusViz").style.display = "none";
                    
                    // Show track buttons
                    d3.select('#buttonTrackMen').style('display', 'initial');
                    d3.select('#buttonTrackWomen').style('display', 'initial');
                    
                    // Hide other pool, discus buttons
                    d3.select('#buttonPoolMen').style('display', 'none');
                    d3.select('#buttonPoolWomen').style('display', 'none');
                    d3.select('#buttonDiscusMen').style('display', 'none');
                    d3.select('#buttonDiscusWomen').style('display', 'none');
                })

                // only show pool
                d3.select("#showPool").on("click", function() {
                    svgPool.selectAll("text").remove();
                    svgPoolGroup.selectAll("*").remove();
                    plotPoolLanes(mens200mFly);
                    document.getElementById("trackViz").style.display = "none";
                    document.getElementById("poolViz").style.display = "inline";
                    document.getElementById("discusViz").style.display = "none";
                    
                    // Show pool buttons
                    d3.select('#buttonPoolMen').style('display', 'initial');
                    d3.select('#buttonPoolWomen').style('display', 'initial');
                    
                    // Hide other track, discus buttons
                    d3.select('#buttonTrackMen').style('display', 'none');
                    d3.select('#buttonTrackWomen').style('display', 'none');
                    d3.select('#buttonDiscusMen').style('display', 'none');
                    d3.select('#buttonDiscusWomen').style('display', 'none');
                })

                // only show discus
                d3.select("#showDiscus").on("click", function() {
                    svgDiscus.selectAll("text").remove();
                    svgDiscusGroup.selectAll("*").remove();
                    plotDiscusThrows(mensDiscus);
                    document.getElementById("trackViz").style.display = "none";
                    document.getElementById("poolViz").style.display = "none";
                    document.getElementById("discusViz").style.display = "inline";
                    
                    // Show discus buttons
                    d3.select('#buttonDiscusMen').style('display', 'initial');
                    d3.select('#buttonDiscusWomen').style('display', 'initial');
                    
                    // Hide other pool, track buttons
                    d3.select('#buttonPoolMen').style('display', 'none');
                    d3.select('#buttonPoolWomen').style('display', 'none');
                    d3.select('#buttonTrackMen').style('display', 'none');
                    d3.select('#buttonTrackWomen').style('display', 'none');
                })

                // plotCountries(countryData);
                
                
                d3.select("#dataSlider").on("input", function() {
                    updatePlot(+this.value);
                });
                
            };
            
            function createCharts(data){
            chartData = data;

            // Create object for each olympic game (key = year)
            chartData.forEach(function(d){

                if (d.game == "Long Jump Mens"){ olympicGoldResults(longJumpM, d); }

                else if (d.game == "Long Jump Womens"){ olympicGoldResults(longJumpW, d); }
                
                else if (d.game == "Hammer Throw Mens"){ olympicGoldResults(hammerM, d); }
                
                 else if (d.game == "Hammer Throw Womens"){ olympicGoldResults(hammerW, d); }
                
                else if (d.game == "400m Freestyle Mens"){ olympicGoldResults(freestyleM, d); }
                
                else if (d.game == "400m Freestyle Womens"){ olympicGoldResults(freestyleW, d); }
                
                else if (d.game == "Hurdles Mens"){ olympicGoldResults(hurdlesM, d); }
                
                else if (d.game == "Hurdles Womens"){ olympicGoldResults(hurdlesW, d); }
                
                else if (d.game == "Shot Put Mens"){ olympicGoldResults(shotPutM, d); }
                
                else if (d.game == "Shot Put Womens"){ olympicGoldResults(shotPutW, d); }
                
                else if (d.game == "Triple Jump Mens"){ olympicGoldResults(tripleJumpM, d); }
                
                else if (d.game == "Triple Jump Womens"){ olympicGoldResults(tripleJumpW, d); }
                
                else if (d.game == "100m Mens"){ olympicGoldResults(trackM, d); }
                
                else if (d.game == "100m Womens"){ olympicGoldResults(trackW, d); }
                
                else if (d.game == "200m Butterfly Mens"){ olympicGoldResults(butterflyM, d); }
                
                else if (d.game == "200m Butterfly Womens"){ olympicGoldResults(butterflyW, d); }
                
                else if (d.game == "Discus Throw Mens"){ olympicGoldResults(discusM, d); }
                
                else if (d.game == "Discus Throw Womens"){ olympicGoldResults(discusW, d); }
                
                else if (d.game == "High Jump Mens"){ olympicGoldResults(highJumpM, d); }
                
                else if (d.game == "High Jump Womens"){ olympicGoldResults(highJumpW, d); }
            
                
            })
            
            var olympicSports = [longJumpM, longJumpW, hammerM, hammerW, freestyleM,freestyleW,hurdlesM, hurdlesW, shotPutM, shotPutW,tripleJumpM, tripleJumpW, trackM, trackW, butterflyM, butterflyW, discusM, discusW, highJumpM, highJumpW];
            
            
            plotChart(longJumpM,longJump_svg,"sportImg/long-jump.svg", "Meters", "Farther", "#0283D9");
            plotChart(hammerM, hammerThrow_svg,"sportImg/hammer-throw.svg", "Meters","Farther","#1175D2" );
            plotChart(freestyleM,freestyle_svg,"sportImg/swimmer.svg", "Seconds","Faster" ,"#2068CC");
            plotChart(hurdlesM,hurdles_svg, "sportImg/track-field.svg","Seconds","Faster" ,"#2F5BC5");
            plotChart(shotPutM,shotPut_svg,"sportImg/shot-put.svg", "Meters","Farther" ,"#3E4EBF");
            plotChart(tripleJumpM, tripleJump_svg,"sportImg/long-jump.svg", "Meters","Farther", "#4D41B9");
            plotChart(trackM, track_svg,"sportImg/sprint.svg", "Seconds","Faster", "#5C34B2");
            plotChart(butterflyM, butterfly_svg,"sportImg/swimmer.svg", "Seconds","Faster", "#6B27AC");
            plotChart(discusM,discusThrow_svg,"sportImg/man-throwing-something.svg", "Meters","Farther", "#7A1AA5");
            plotChart(highJumpM, highJump_svg,"sportImg/high-jump.svg", "Meters", "Farther","#890D9F");
            };
                        
        </script>
    </p>
        
    <div id = "trackViz">
        <script>
            var width = 960, height = 640;

            var xTrackScale = d3.scaleLinear().domain([0,100]).range([120,720]);
            var xTrackScale2 = d3.scaleLinear().domain([80,100]).range([120,720]); // zoom into points

            var yScaleMen = d3.scaleLinear().domain([0,25]).range([490,90]);
            var yScaleWomen = d3.scaleLinear().domain([0,21]).range([490,90]);

            // Create SVG
            var svgTrack = d3.select("#trackViz")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

            var svgTrackGroup = svgTrack.append("g");
            
            // 100M Men's Record
            var recordTimeMen = 9.63; 
            var recordSpeedMen = 100/recordTimeMen;
            
            // 100M Women's Record
            var recordTimeWomen = 10.71;
            var recordSpeedWomen = 100/recordTimeWomen;
            
            function plotTracks(data) {
                
                // Initializa variables
                var plottingData  = [];
                var recordTime;
                var n = 1;

                if (data == mens100m) {
                    recordTime = recordTimeMen
                } else {
                    recordTime = recordTimeWomen } 
                
                for (y in data) {
                    
                    var bronzeDistance = data[y].bronze.speed*recordTime;
                    plottingData.push({game: data[y].bronze.game, start: 0, end: bronzeDistance,speed:data[y].bronze.speed, result: data[y].bronze.result, color: "orange", order:n, year: y, medal: "bronze", athlete: data[y].bronze.athlete, country: data[y].bronze.country});
                    
                    var silverDistance = data[y].silver.speed*recordTime;
                    plottingData.push({game: data[y].silver.game, start: 0, end: silverDistance, speed:data[y].silver.speed, result: data[y].silver.result, color: "grey", order: n, year: y, medal: "silver", athlete: data[y].silver.athlete, country: data[y].silver.country});
                    
                    var goldDistance = data[y].gold.speed*recordTime;
                    plottingData.push({game: data[y].gold.game, start: 0, end: goldDistance, speed:data[y].gold.speed, result: data[y].gold.result, color: "gold", order: n, year: y, medal: "gold", athlete: data[y].gold.athlete, country: data[y].gold.country });
                            
                    n++;
                }

                // Set y-scale
                var yScale;
                if (data == mens100m) {
                    yScale = yScaleMen;
                } else {
                    yScale = yScaleWomen;
                }

                // Add track for each olympic year
                var raceTrack = svgTrackGroup.selectAll("g").data(plottingData).enter().append("rect");

                raceTrack
                    .attr("width", 640)
                    .attr("height", function() {
                        return 14;
                        // if (data == mens100m) { return 14 }
                        // else { return 17 }
                    })
                    .attr("x", 120)
                    .attr("y", function(d) {
                        return yScale(d.order) - 8 + 120;
                        // if (data == mens100m) { return yScale(d.order) - 7 + 120 }
                        // else { return yScale(d.order) - 17/2 + 120 }
                    })
                    .style("fill", "lightgray")
                    .style("opacity", .05);

                // Finish Line
                svgTrackGroup.append("rect")
                    .attr("x", xTrackScale(100))
                    .attr("y", function() {
                        if (data == mens100m) { return yScale(24.5) + 120 }
                        else if (data == womens100m) { return yScale(20.4) + 120 }
                        else { return yScale(21) + 120 }
                    })
                    .attr("width", 1.5)
                    .attr("height", function() {
                        if (data == mens100m) { return 382 }
                        else { return 375 }
                    })
                    .style("fill", 'lightcoral')
                    .style("stroke", "grey")
                    .style("stroke-width", 0);

                svgTrackGroup.append("text").text("Finish")
                    .attr('class', 'finish')
                    .attr("x", -408)
                    .attr("y", 744)
                    .attr("transform", "rotate(270)")
                    .style("text-anchor", "middle");
                
                // Add gold, bronze, and silver medal plots
                var circles = svgTrackGroup.selectAll("g").data(plottingData)
                .enter().append("circle");

                circles
                    .attr('class', 'filter-circles')
                    .attr("cx", function(d) {return xTrackScale(d.start)})
                    .attr("cy",function(d) {return yScale(d.order) - 1 + 120 })
                    .attr("r", 5)
                    .style("fill", function(d) {return d.color})
                    .style('opacity', 0.85)
                    .style('cursor', 'crosshair');

                circles
                .transition()
                    .ease(d3.easePoly)
                    .duration(2000)
                    .attr('cx', function(d,i) { return xTrackScale(d.end) })
                // .transition()
                    // .duration(1000)
                .transition()
                    .ease(d3.easePoly)
                    .duration(2000)
                    .attr('cx', function(d,i) { return xTrackScale2(d.end) });


                // Add y-axis text: years
                var olympicYears = svgTrack.selectAll("g").data(plottingData).enter().append("text");

                olympicYears.text(function(d) {return d.year})
                    .attr('class', 'axis-label')
                    .attr("x", 72)
                    .attr("y", function(d) {return yScale(d.order) + 120})
                    .style("alignment-baseline", "middle");
                    // .style("font-size", 12)
                    // .style("font-weight", 200)
                    // .style("fill", "grey");

                // Add titles
                svgTrack.append("text").text(function() {
                    if (data == mens100m) { return "Olympic 100M Men's" }
                    else { return "Olympic 100M Women's" }
                })
                    .attr('class', 'title')
                    .attr('x', function() {
                        if (data == mens100m) { return 367.67; }
                        else { return 348.6; }
                    })
                    .attr("y", 45);
                    // .style("font-size", 25)
                    // .style("font-weight", 600);

                
                // Add description
                svgTrack.append('foreignObject').text("The 100 metres at the Summer Olympics has been contested since the first edition of the multi-sport event. The men's 100 m has been present on the Olympic athletics programme since 1896 and the women's 100 m has been held continuously since its introduction at the 1928 Games. The 100 metres is considered one of the blue ribbon events of the Olympics and is among the highest profile competitions at the games. It is the most prestigious 100 m race at elite level and is the shortest sprinting competition.")
                    .attr('class', 'subtitle')
                    .attr("x", 160)
                    .attr("y", 70)
                    // .style("font-size", 16)
                    // .style("font-weight", 400);

                // Add x-axis text: distance in meters
                svgTrack.append("text").text("100m")
                    .attr('class', 'axis-label')
                    .attr("x", xTrackScale(98))
                    .attr("y", 624)
                    .style("anchor", "middle");

                var eighty = svgTrack.append("text").text("80m")
                    .attr('class', 'axis-label')
                    .attr("x", xTrackScale(80))
                    .attr("y", 624)
                    .style("anchor", "middle");

                var ninety = svgTrack.append("text").text("90m")
                    .attr('class', 'axis-label')
                    .attr("x", xTrackScale(90))
                    .attr("y", 624)
                    .style("anchor", "middle");

                var fifty = svgTrack.append("text").text("50m")
                    .attr('class', 'axis-label')
                    .attr("x", xTrackScale(50))
                    .attr("y", 624)
                    .style("anchor", "middle");

                eighty
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xTrackScale(80) )
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xTrackScale2(80) )

                ninety
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xTrackScale(90) )
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xTrackScale2(90) )

                fifty
                    .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xTrackScale(50) )
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xTrackScale2(50) )
                    .style("opacity", -5);
                
                // Calls function for plotting descriptions
                if (data == mens100m) { plotHover(data, plottingData, circles, "track", "mens") }
                else { plotHover(data, plottingData, circles, "track", "womens") }
                
                // Calls function for filtering by country
                filterCountries(data, plottingData, circles);
                
                // Calls function for filtering by medal
                filterMedals(data, plottingData, circles, 'track');
                
            }
            
            function plotHover(data, plottingData, objects, event, gender) {
                
                var countries = [];

                if (event == "track") {
                    svgGroup = svgTrackGroup;
                    xScale2 = xTrackScale2;
                    if (gender == "mens" ) { yScale = yScaleMen }
                    else { yScale = yScaleWomen }
                }
                else if (event == "pool") {
                    svgGroup = svgPoolGroup;
                    xScale2 = xPoolScale2;
                    if (gender == "mens" ) { yScale = yPoolScaleMen }
                    else { yScale = yPoolScaleWomen }
                }
                else {
                    svgGroup = svgDiscusGroup
                    xScale2 = xDiscusScale2;
                    if (gender == "mens" ) { yScale = yDiscusScaleMen }
                    else { yScale = yDiscusScaleWomen }
                }

                // Append the rectangles
                var rects = svgGroup.selectAll('g').data(plottingData).enter().append('rect');
                
                // Append the flag iamges
                var flags = svgGroup.selectAll('g').data(plottingData).enter().append('image');
                
                // Populate list of countries
                for (key in data) {
                    var c1 = data[key].gold.country;
                    if (countries.includes(c1) == false) {
                        countries.push(c1);
                    } 
                    var c2 = data[key].silver.country;
                    if (countries.includes(c2) == false) {
                        countries.push(c2); }
                    var c3 = data[key].bronze.country;
                    if (countries.includes(c3) == false) {
                        countries.push(c3);
                    }
                }
                // console.log(countries);
                
                // Append the text onto the rectangles
                var texts = svgGroup.selectAll('g').data(plottingData).enter().append('text');
                
                rects.attr('id', function(d) {return d.medal+d.year+d.game})
                    .attr('x', function(d) {return xScale2(d.end)-75})
                    .attr('rx', '6px')
                    .attr('ry', '6px')
                    .attr('width', '155px')
                    .attr('height', '70px')
                    .style('fill', function(d) {
//                        if (d.medal == "gold") { return "gold" }
//                        else if (d.medal == "silver") { return "grey" }
//                        else { return "orange" }
                        return 'white';
                    })
                    .style('opacity', 0.85)
                    .style('display', 'none');
                
                
                flags.attr('id', function(d) {return d.medal+d.year+d.game+'flag'})
                    .attr('xlink:href', function (d) {return 'img/flags/'+d.country+'.svg'})
                    .attr('x', function (d) {return xScale2(d.end)-65})
                    .attr('width', '25px')
                    .style('display','none');

                texts.attr('id', function(d) {return d.medal+d.year+d.game+'text'})
                    .attr('class', 'hover-athlete')
                    .attr('x', function(d) {return xScale2(d.end)-30})
                    .attr('width', '145px')
                    .attr('height', '65px')
                    // .style('fill', 'indianred')
                    .style('display', 'none')
                    .style('word-breal', 'all')
                    .text(function(d) {
                        var ath = d.athlete.split(' ');
                        var lastname = ath[1].charAt(0) + ath[1].slice(1).toLowerCase();
                        ath[1] = lastname;
                        return ath[0]+' '+ath[1];
                    });
                
                texts.append('tspan')
                    .attr('class', 'hover-desc')
                    .attr('x', function(d) {return xScale2(d.end)-30})
                    .attr('dy', '12px')
                    .text(function(d) {
                        return 'Country: '+d.country;
                    });

                
                if (event == "discus") {
                    texts.append('tspan')
                        .attr('class', 'hover-desc')
                        .attr('x', function (d) {return xScale2(d.end)-30})
                        .attr('dy', '12px')
                        .text(function(d) {
                            return 'Distance: '+d.result.toFixed(2)+' m';
                        }); 
                } else {    

                    texts.append('tspan')
                        .attr('class', 'hover-desc')
                        .attr('x', function (d) {return xScale2(d.end)-30})
                        .attr('dy', '12px')
                        .text(function(d) {
                            return 'Time: '+d.result.toFixed(2)+ ' s';
                    }); 

                    texts.append('tspan')
                        .attr('class', 'hover-desc')
                        .attr('x', function (d) {return xScale2(d.end)-30})
                        .attr('dy', '12px')
                        .text(function(d) {
                            return 'Speed: '+d.speed.toFixed(2)+' m/s';
                        }); 
                } 
                
                
                objects
                    .on('mouseenter', function(d) {
                    
                        var id = d.medal+d.year+d.game;
                        // console.log('click');
                        // console.log('#hover'+id);
                        // console.log(d3.select('#hover'+id));
                    
                        // If game is track
                        if (event == 'track') {
                            // If circles on upper half of graph
                            if (d.year >= 1968) {
                                rects.attr('y', function(d) {return yScale(d.order)+15+120});
                                flags.attr('y', function(d) {return yScale(d.order)+25+120});
                                texts.attr('y', function(d) {return yScale(d.order)+35+120});
                            } else { 
                                // if (d.year <= 1964)
                                rects.attr('y', function (d) {return yScale(d.order)-70-15+120});
                                flags.attr('y', function(d) {return yScale(d.order)-70-5+120});
                                texts.attr('y', function(d) {return yScale(d.order)-70+5+120});
                            }

                            d3.select('#'+id).style('display', 'inline');
                            d3.select('#'+id+'flag').style('display', 'inline');
                            d3.select('#'+id+'text').style('display', 'inline');
                        }
                        // If game is pool
                        else if (event == 'pool') {
                            // If circles on upper half of graph
                            if (d.year >= 1988) {
                                rects.attr('y', function(d) {return yScale(d.order)+15-72});
                                flags.attr('y', function(d) {return yScale(d.order)+25-72});
                                texts.attr('y', function(d) {return yScale(d.order)+35-72});
                            } else { 
                                // if (d.year <= 1984)
                                rects.attr('y', function (d) {return yScale(d.order)-70-15-72});
                                flags.attr('y', function(d) {return yScale(d.order)-70-5-72});
                                texts.attr('y', function(d) {return yScale(d.order)-70+5-72});
                            }

                            d3.select('#'+id).style('display', 'inline');
                            d3.select('#'+id+'flag').style('display', 'inline');
                            d3.select('#'+id+'text').style('display', 'inline');
                        }
                        
                })
                .on('mouseleave', function(d) {
                    var id = d.medal+d.year+d.game;
                    d3.select('#'+id).style('display', 'none');
                    d3.select('#'+id+'flag').style('display', 'none');
                    d3.select('#'+id+'text').style('display', 'none');
                });
            }

        </script>
        
        <script>
            // Legends, keys, and filters
            
            // Record Holder    
            var recordHolder = svgTrackGroup.append("text")
                .text("Record: 9.63 seconds")
                .attr("x", 1100).attr("y", 200);
            
            // Filter: by countries
            function filterCountries(data, plottingData, objects) {
                // Variables
                var counts = {};
                var count = 0;
                
                // Append the flag iamges
                var filter = svgGroup.selectAll('g').data(plottingData).enter().append('image');
                
                filter
                    .attr('xlink:href', function (d) {
                        if (d.country in counts == false) {
                            counts[d.country] = [count, 1];
                            count++;
                            // console.log(counts);
                            // console.log('Entering');
                            return 'img/flags/'+d.country+'.svg';
                        } else {
                            counts[d.country][1] ++;
                        }
                        
                    })
                    .attr('x', function(d) {
                        if (data == mens100m || data == womens100m) {
                            if (counts[d.country][0] <= 8) {
                                return 804;
                            } else {
                                return 876;
                            }   
                        } else if (data == mens200mFly) {
                            if (counts[d.country][0] <= 7) {
                                return 804;
                            } else {
                                return 876;
                            }  
                        } else if (data == womens200mFly) {
                            if (counts[d.country][0] <= 4) {
                                return 804;
                            } else {
                                return 876;
                            }
                        }
                                      
                    })
                    .attr('y', function(d) {
                        var increment;
                        if (data == mens100m || data == womens100m) {
                            if (counts[d.country][0] <= 8) {
                                increment = counts[d.country][0];
                            } else {
                                increment = counts[d.country][0] - 9;
                            }
                            return 258+increment*24;
                        } else if (data == mens200mFly) {
                            if (counts[d.country][0] <= 7) {
                                increment = counts[d.country][0];
                            } else {
                                increment = counts[d.country][0] - 8;
                            }
                            return 258+increment*24-48;
                        } else if (data == womens200mFly) {
                            if (counts[d.country][0] <= 4) {
                                increment = counts[d.country][0];
                            } else {
                                increment = counts[d.country][0] - 5;
                            }
                            return 258+increment*24-48;
                        }
                        
                        
                    })
                    .attr('width', '18px')
                    .on('mousedown', function(d) {
                        var click = d.country;
                        d3.selectAll('.filter-circles')
                            .style('opacity', function(d) {
                                if (d.country != click) {
                                    return '0.1';
                                }
                            })
                    })
                    .on('mouseup', function(d) {
                        svgGroup.selectAll('.filter-circles').style('opacity', 1);
                    })
                    .style('cursor', 'pointer')
                    .style('display', function(d) {
                        // if (d.country == 'POR') { return 'none'; }
                        // else if (counts[d.country][0] >= 16) { return 'none'; }
                    });        
                
                // Filter by countries
                var labelCountries = svgGroup.append('text');
                labelCountries
                    .attr('class', 'axis-title')
                    .attr('x', 804)
                    .attr('y', function() {
                        if (data == mens100m || data == womens100m) {
                            return 234;
                        } else if (data == mens200mFly || data == womens200mFly) {
                            return 186;
                        }
                        
                    })
                    .text('Filter by Country');
                
                var labels = svgGroup.selectAll('g').data(plottingData).enter().append('text');
                var countryLabels = [];
                
                labels
                    .attr('class', 'country-label')
                    .attr('x', function(d) {
                        if (data == mens100m || data == womens100m) {
                            if (counts[d.country][0] <= 8) {
                                return 804 + 24;
                            } else {
                                return 876 + 24;
                            }
                        } else if (data == mens200mFly) {
                            if (counts[d.country][0] <= 7) {
                                return 804 + 24;
                            } else {
                                return 876 + 24;
                            }
                        } 
                        else if (data == womens200mFly) {
                            if (counts[d.country][0] <= 4) {
                                return 804 + 24;
                            } else {
                                return 876 + 24;
                            }
                        }
                         
//                        if (counts[d.country][0] <= 3) {
//                                return 1050+35;
//                            } else if (counts[d.country][0] > 3 && counts[d.country][0] <= 7) {
//                                return 1125+35;
//                            } else if (counts[d.country][0] > 7 && counts[d.country][0] <= 11) {
//                                return 1200+35;
//                            } else {
//                                return 1275+35;
//                            }
                    })
                    .attr('y', function(d) {
                        var increment;
                        if (data == mens100m || data == womens100m) {
                            if (counts[d.country][0] <= 8) {
                                increment = counts[d.country][0];
                            } else {
                                increment = counts[d.country][0] - 9;
                            }
                            return 258+increment*24 + 14;
                        } else if (data == mens200mFly) {
                            if (counts[d.country][0] <= 7) {
                                increment = counts[d.country][0];
                            } else {
                                increment = counts[d.country][0] - 8;
                            }
                            return 258+increment*24 + 14 - 48;
                        } else if (data == womens200mFly) {
                            if (counts[d.country][0] <= 4) {
                                increment = counts[d.country][0];
                            } else {
                                increment = counts[d.country][0] - 5;
                            }
                            return 258+increment*24 + 14 - 48;
                        }
                        
//                        var increment;
//                        if (counts[d.country][0] <= 3) {
//                            increment = counts[d.country][0];
//                        } else if (counts[d.country][0] > 3 && counts[d.country][0] <= 7) {
//                            increment = counts[d.country][0] - 4;
//                        } else if (counts[d.country][0] > 7 && counts[d.country][0] <= 11) {
//                            increment = counts[d.country][0] - 8;
//                        } else {
//                            increment = counts[d.country][0] - 12;
//                        }
//                        return 250+increment*35 + 18;
                    })
                    // .attr('width', '145px')
                    // .attr('height', '65px')
                    // .style('fill', 'indianred')
                    .text(function(d) {
                        if (countryLabels.includes(d.country) == false) {
                            countryLabels.push(d.country);
                            return d.country;    
                        } 
                    })
                    .style('display', function(d) {
                        // if (d.country == 'POR') { return 'none'; }
                        // else if (counts[d.country][0] >= 16) { return 'none'; }
                    });
            }
            
            function filterMedals(data, plottingData, objects, game) {

                // Select svgGroup that corresponds to the game
                var svgGroupSelect;
                if (game == 'track') {
                    svgGroupSelect = svgTrackGroup;
                } else if (game == 'pool') {
                    svgGroupSelect =  svgPoolGroup;
                } else {
                    svgGroupSelect = svgDiscusGroup;
                }
                
                // Create label
                var labelMedals = svgGroupSelect.append('text');
                labelMedals
                    .attr('class', 'axis-title')
                    .attr('x', 804)
                    .attr('y', function() {
                        if (data == mens100m || data == womens100m) {
                            return 540-30;
                        } else if (data == mens200mFly || data == womens200mFly) {
                            return 600;
                        }
                        
                    })
                    .text('Filter by Medal');
                
                // Create medals
                var goldMedal = svgGroupSelect.append('circle')
                    .attr('cx', 813).attr('cy', 540)
                    .attr('r', 5)
                    .style('fill', 'gold')
                    .style('opacity', 0.85)
                    .style('cursor', 'pointer')
                    .on('mousedown', function(d) {
                        d3.selectAll('.filter-circles').style('opacity', function(d) {
                            if (d.medal != 'gold') {
                                return '0.1';
                            }
                        })
                    })
                    .on('mouseup', function(d) {
                        d3.selectAll('.filter-circles').style('opacity', 1);
                    });
                
                var silverMedal = svgGroupSelect.append("circle")
                    .attr('cx', 849).attr("cy", 540)
                    .attr("r", 5)
                    .style("fill", "grey")
                    .style('opacity', 0.85)
                    .style('cursor', 'pointer')
                    .on('mousedown', function(d) {
                        d3.selectAll('.filter-circles').style('opacity', function(d) {
                            if (d.medal != 'silver') {
                                return '0.1';
                            }
                        })
                    })
                    .on('mouseup', function(d) {
                        d3.selectAll('.filter-circles').style('opacity', 1);
                    });
            
                var bronzeMedal = svgGroupSelect.append("circle")
                    .attr("cx", 885).attr("cy", 540)
                    .attr("r", 5)
                    .style("fill", "orange")
                    .style('opacity', 0.85)
                    .style('cursor', 'pointer')
                    .on('mousedown', function(d) {
                        d3.selectAll('.filter-circles').style('opacity', function(d) {
                            if (d.medal != 'bronze') {
                                return '0.1';
                            }
                        })
                    })
                    .on('mouseup', function(d) {
                        d3.selectAll('.filter-circles').style('opacity', 1);
                    });
            }
        </script>
    </div>

    <p id="poolViz">
        <script>           
            var xPoolScale = d3.scaleLinear().domain([0,200]).range([120,720]);
            var xPoolScale2 = d3.scaleLinear().domain([150,200]).range([120,720]); // zoom into points

            var yPoolScaleMen = d3.scaleLinear().domain([0,25]).range([490,90]);
            var yPoolScaleWomen = d3.scaleLinear().domain([0,21]).range([490,90]);
            // var yPoolScaleMen = d3.scaleLinear().domain([0,16]).range([490,90]);
            // var yPoolScaleWomen = d3.scaleLinear().domain([0,13]).range([490,90]);

            // Create SVG
            var svgPool = d3.select("#poolViz")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            var svgPoolGroup = svgPool.append("g");
            
            // 200M Butterfly Men's Record
            var recordTimeFlyMen = 112.03;
            var recordSpeedFlyMen = 200/recordTimeFlyMen;

            // 200M Butterfly Women's Record
            var recordTimeFlyWomen = 124.06;
            var recordSpeedFlyWomen = 200/recordTimeFlyWomen;

            function plotPoolLanes(data) {
                
                // Initialize variables
                var plottingData  = []; // Array of objects
                var recordTimeFly;
                var n = 1;

                if (data == mens200mFly) {
                    recordTimeFly = recordTimeFlyMen
                } else {
                    recordTimeFly = recordTimeFlyWomen } 

                for (y in data) {

                    var bronzeDistance = data[y].bronze.speed*recordTimeFly;
                    plottingData.push({game: data[y].bronze.game, start: 0, end: bronzeDistance,speed:data[y].bronze.speed, result: data[y].bronze.result, color: "orange", order:n, year: y, medal: "bronze", athlete: data[y].bronze.athlete, country: data[y].bronze.country});
                    
                    var silverDistance = data[y].silver.speed*recordTimeFly;
                    plottingData.push({game: data[y].silver.game, start: 0, end: silverDistance, speed:data[y].silver.speed, result: data[y].silver.result, color: "grey", order: n, year: y, medal: "silver", athlete: data[y].silver.athlete, country: data[y].silver.country});
                    
                    var goldDistance = data[y].gold.speed*recordTimeFly;
                    plottingData.push({game: data[y].gold.game, start: 0, end: goldDistance, speed:data[y].gold.speed, result: data[y].gold.result, color: "gold", order: n, year: y, medal: "gold", athlete: data[y].gold.athlete, country: data[y].gold.country });

                    n++;     
                }

                var yPoolScale;

                if (data == mens200mFly) {
                    yPoolScale = yPoolScaleMen;
                } else {
                    yPoolScale = yPoolScaleWomen;
                }

                // Add track for each olympic year
                var poolLanes = svgPoolGroup.selectAll("g").data(plottingData).enter().append("rect");

                poolLanes
                    .attr('width', 640)
                    .attr('height', function() {
                        return 14;
                        // if (data == mens200mFly) { return 24 }
                        // else { return 30 }
                    })
                    .attr('x', 120)
                    .attr('y', function(d) {
                        return yPoolScale(d.order) - 8 - 72;
                        // if (data == mens200mFly) { return yPoolScale(d.order) - 12 }
                        // else { return yPoolScale(d.order) - 15 }
                    })
                    .style("fill", 'lightblue')
                    .style("opacity", .05);
                
                // Finish Line
                svgPoolGroup.append("rect")
                    .attr("x", xPoolScale(200))
                    .attr("y", function() {
                        if (data == mens200mFly) { return yPoolScale(15.5) - 72 }
                        else { return yPoolScale(12.4) - 72 }
                    })
                    .attr("width", 1.5)
                    .attr("height", function() {
                        if (data == mens200mFly) { return 238 }
                        else { return 223 }
                    })
                    .style("fill", 'lightcoral')
                    .style("stroke", "grey")
                    .style("stroke-width", 0);

                svgPoolGroup.append("text").text("Finish")
                    .attr('class', 'finish')
                    .attr("x", -288)
                    .attr("y", 744)
                    .attr("transform", "rotate(270)")
                    .style("text-anchor", "middle");

                // Add gold, bronze, and silver medal plots
                var circles = svgPoolGroup.selectAll("g").data(plottingData)
                .enter().append("circle");

                circles
                    .attr('class', 'filter-circles')
                    .attr("cx", function(d) {return xPoolScale(d.start)})
                    .attr("cy",function(d) {return yPoolScale(d.order) - 1 - 72})
                    .attr("r", 5)
                    .style("fill", function(d) {return d.color})
                    .style('opacity', 0.85)
                    .style('cursor', 'crosshair');

                circles
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('cx', function(d,i) { return xPoolScale(d.end) })
                // .transition()
                    // .duration(1000)
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('cx', function(d,i) { return xPoolScale2(d.end) });

                // Add y-axis text: years
                var olympicYears = svgPool.selectAll("g").data(plottingData).enter().append("text");
                
                olympicYears.text(function(d) {return d.year})
                    .attr('class', 'axis-label')
                    .attr("x", 72)
                    .attr("y", function(d) {return yPoolScale(d.order) - 72})
                    .style("alignment-baseline", "middle");

                // Add titles
                svgPool.append('text')
                    .attr('class', 'title')
                    .attr('x', function() {
                        if (data == mens200mFly) { return 318.665; }
                        else { return 299.595; }
                    })
                    .attr('y', 45)
                    .text(function() {
                        if (data == mens200mFly) { return "Olympic 200M Butterfly Men's" }
                        else { return "Olympic 200M Butterfly Women's" }
                    });

                svgPool.append('foreignObject').text("Swimming has been a sport at every modern Summer Olympics. It has been open to women since 1912. Along with track & field athletics and gymnastics, it is one of the most popular spectator sports at the Games. Swimming has the second largest number of events (after Athletics).")
                    .attr('class', 'subtitle')
                    .attr("x", 160)
                    .attr("y", 70)
                
                // Add x-axis text: distance in meters
                svgPool.append("text").text("200m")
                    .attr('class', 'axis-label')
                    .attr("x", xPoolScale(200))
                    .attr("y", 432)
                    .style("anchor", "middle");

                var hundred = svgPool.append("text").text("100m")
                    .attr('class', 'axis-label')
                    .attr("x", xPoolScale(100))
                    .attr("y", 432)
                    .style("anchor", "middle");

                var oneFifty = svgPool.append("text").text("150m")
                    .attr('class', 'axis-label')
                    .attr("x", xPoolScale(150))
                    .attr("y", 432)
                    .style("anchor", "middle");

                var oneSeventyFive = svgPool.append("text").text("175m")
                    .attr('class', 'axis-label')
                    .attr("x", xPoolScale(175))
                    .attr("y", 432)
                    .style("anchor", "middle");


                hundred
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xPoolScale(100) )
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xPoolScale2(100) )
                    .style("opacity", -5)

                oneFifty
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xPoolScale(150) )
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xPoolScale2(150) )

                oneSeventyFive
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xPoolScale(175) )
                .transition()
                    .duration(2000)
                    .ease(d3.easePoly)
                    .attr('x', xPoolScale2(175) )

                // Calls function for hovering
                if (data == mens200mFly) { plotHover(data, plottingData, circles, "pool", "mens") }
                else { plotHover(data, plottingData, circles, "pool", "womens") }
                
                // Calls function for filtering by country
                filterCountries(data, plottingData, circles);
                
            }

        </script>

    </p>

    <p id="discusViz">
        <script>
        
            var xDiscusScale = d3.scaleLinear().domain([0,70]).range([100,1000]);

            var xDiscusScale2 = d3.scaleLinear().domain([25,70]).range([100,1000]); // zoom into points

            var yDiscusScaleMen = d3.scaleLinear().domain([0,20]).range([490,90]);
            var yDiscusScaleWomen = d3.scaleLinear().domain([0,18]).range([490,90]);

            // Create SVG
            var svgDiscus = d3.select("#discusViz")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

            var svgDiscusGroup = svgDiscus.append("g");

            function plotDiscusThrows(data) {
                
                var plottingData  = []; // Array of objects
    
                n = 1;
                
                for (y in data) {

                    plottingData.push({game: data[y].bronze.game, start: 0, end: data[y].bronze.result, result: data[y].bronze.result, color: "orange", order:n, year: y, medal: "bronze", athlete: data[y].bronze.athlete, country: data[y].bronze.country});
                    
                    plottingData.push({game: data[y].silver.game, start: 0, end: data[y].silver.result, result: data[y].silver.result, color: "grey", order: n, year: y, medal: "silver", athlete: data[y].silver.athlete, country: data[y].silver.country});
                    
                    plottingData.push({game: data[y].gold.game, start: 0, end: data[y].gold.result, result: data[y].gold.result, color: "gold", order: n, year: y, medal: "gold", athlete: data[y].gold.athlete, country: data[y].gold.country });

                    n++;     
                }

                var yDiscusScale;

                if (data == mensDiscus) {
                    yDiscusScale = yDiscusScaleMen;
                } else {
                    yDiscusScale = yDiscusScaleWomen;
                }

                // Add track for each olympic year
                var discusPath = svgDiscusGroup.selectAll("g").data(plottingData).enter().append("rect");

                discusPath.attr("width", 900).attr("height", function() {
                    if (data == mensDiscus) { return 19 }
                    else { return 21 }
                })
                .attr("x", 100).attr("y", function(d) {
                    if (data == mensDiscus) { return yDiscusScale(d.order) - 19/2 }
                    else { return yDiscusScale(d.order) - 21/2 }
                })
                .style("fill", "lightgreen")
                .style("opacity", .1);

                // Finish Line
                svgDiscusGroup.append("rect")
                .attr("x", xDiscusScale(70))
                .attr("y", function() {
                    if (data == mensDiscus) { return yDiscusScale(20) }
                    else { return yDiscusScale(18) }
                })
                .attr("width", 50)
                .attr("height", 400)
                .style("fill", "white")
                .style("stroke", "grey")
                .style("stroke-width", .5);

                svgDiscusGroup.append("text").text("FINISH")
                .attr("x", -300)
                .attr("y", 1035)
                .attr("transform", "rotate(270)")
                .style("text-anchor", "middle")
                .style("font-size", 25)
                .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");

                // paths that circles will move along
                var motionPaths = svgDiscusGroup.selectAll("g").data(plottingData)
                .enter().append("path")
                .attr("d", function(d) {
                    // M xStart yStart Q xControl yControl xEnd yEnd
                    return "M " + xDiscusScale(d.start) + " " + yDiscusScale(d.order) +  
                            " Q " + xDiscusScale(d.result/2) + " " + (yDiscusScale(d.order) - d.result * 3.5) + 
                            " " +  xDiscusScale(d.result) + " " + yDiscusScale(d.order);
                })
                .attr("id", function(d) { return d.color + d.year }) // e.g. "gold2016"
                .attr("class", "trajectory")
                .style("fill", "none")
                .style("stroke", "lightgrey")
                
                animateLines();
                
                // Add gold, bronze, and silver medal circles
                var circles = svgDiscusGroup.selectAll("g").data(plottingData)
                .enter().append("circle");

                circles.attr("cx", function(d) {return xDiscusScale(d.start)})
                .attr("cy",function(d) {return yDiscusScale(d.order)})
                .attr("class", "firstCircles")
                .attr("r", 5)
                .style("fill", function(d) {return d.color});

                // move circles along path
                circles.transition()
                    .duration(3000)
                    .ease(d3.easeLinear)
                    .attrTween("transform", function(d) {
                        var path = d3.select("#" + d.color + d.year);
                        return translateAlong(path.node());
                    })

                // remove first circles
                svgDiscusGroup.selectAll("circle").transition()
                .delay(3250)
                .on('end', function(d) {
                    svgDiscusGroup.selectAll(".firstCircles").remove()
                })

                // secretly plot circles at ending points
                var secondCircles = svgDiscusGroup.selectAll("g").data(plottingData)
                .enter().append("circle");

                secondCircles.attr("cx", function(d) {return xDiscusScale(d.end)})
                .attr("cy",function(d) {return yDiscusScale(d.order)})
                .attr("r", 5)
                .style("fill", function(d) {return d.color})
                .style("opacity", 0)

                // make circles visible and then rescale
                secondCircles.transition()
                    .delay(3500)
                    .duration(1)
                    .style("opacity", 1)
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr("cx", function(d) {
                        return xDiscusScale2(d.end)
                    })

                function animateLines() {
                    d3.selectAll(".trajectory").each(function(d,i) {
                        var totalLength = d3.select("#" + d.color + d.year).node().getTotalLength();
                        d3.select("#" + d.color + d.year).attr("stroke-dasharray", totalLength + " " + totalLength)
                        .attr("stroke-dashoffset", totalLength)
                        .transition()
                            .duration(3000)
                            .ease(d3.easeLinear)
                            .attr("stroke-dashoffset", 0)
                            .style("stroke-width", 1)
                        .transition() // make lines disappear
                            .duration(1000)
                            .style("opacity", 0) 

                    })
                }

                function translateAlong(path) {
                    var l = path.getTotalLength();
                    return function(t) {
                        var p = path.getPointAtLength(t * l);
                        var init = path.getPointAtLength(0)
                        return "translate(" + (p.x - init.x) + "," + (p.y - init.y) + ")";
                    };
                } 

                // Add y-axis text: years
                var olympicYears = svgDiscus.selectAll("g").data(plottingData).enter().append("text");

                olympicYears.text(function(d) {return d.year})
                .attr("x", 50)
                .attr("y", function(d) {return yDiscusScale(d.order)})
                .style("alignment-baseline", "middle")
                .style("font-size", 12)
                .style("font-family", "Roboto")
                .style("font-weight", 200)
                .style("fill", "grey");

                // Add titles
                svgDiscus.append("text").text(function() {
                    if (data == mensDiscus) { return "Olympic Discus Throw Mens" }
                    else { return "Olympic Discus Throw Womens" }
                })
                .attr("x", xDiscusScale(0))
                .attr("y", 45)
                .style("font-size", 25)
                .style("font-family", "Roboto")
                .style("font-weight", 600);

                // Add x-axis text: distance in meters
                svgDiscus.append("text").text("70m")
                .attr("x", xDiscusScale(70))
                .attr("y", 500)
                .style("anchor", "middle");

                var fifty = svgDiscus.append("text").text("50m")
                .attr("x", xDiscusScale(50))
                .attr("y", 500)
                .style("anchor", "middle");

                var twentyFive = svgDiscus.append("text").text("25m")
                .attr("x", xDiscusScale(25))
                .attr("y", 500)
                .style("anchor", "middle");

                twentyFive.transition()
                .duration(4000)
                    .attr('x', xDiscusScale(25) )
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr('x', xDiscusScale2(25) )

                fifty.transition()
                .duration(4000)
                    .attr('x', xDiscusScale(50) )
                .transition()
                    .duration(4000)
                    .ease(d3.easeLinear)
                    .attr('x', xDiscusScale2(50) )

                if (data == mensDiscus) { plotHover(data, plottingData, secondCircles, "discus", "mens") }
                else { plotHover(data, plottingData, secondCircles, "discus", "womens") }

            }

        </script>

    </p>
    </div>
    
    <div id='plotCountries'></div>
    <script>
        // Country data visualization
        
        // Create SVG
        // var svgCountry = d3.select('#plotCountries').append("svg")
            // .attr("width", 1400)
            // .attr("height", 2300);
        // var svgCountryGroup = svgCountry.append('g');
        
        // Create country array
        var cData = [];
        
        // Append country flags
        function plotCountries(data) {
            
            // For each country in data
            var counter = 0;
            for (c in data) {
                
                // Populate cData array
                cData.push({country: c, total: data[c].total, gold: data[c].gold, silver: data[c].silver, bronze: data[c].bronze, byyear: data[c].byyear})
                
                // Create a 'g' for each country
                var countryGroup = svgCountry.append('g').data(cData);
                
                // Append the flag iamges
                var countries = countryGroup.append('image');
                
                countries.attr('id', ''+counter+c)
                    .attr('xlink:href', function () {
                        if (c=='EUN' || c=='None') {
                            return ;
                        } else {
                            return 'img/flags/'+c+'.svg';
                        }  
                    })
                    .attr('x', '50px')
                    .attr('y', 50+35*counter)
                    .attr('width', '25px');
                
                // Append the country names
                var cNames = countryGroup.append('text');
                
                cNames
                    .attr('class', 'hover-athlete')
                    .attr('x', '90px')
                    .attr('y', 68+35*counter)
                    .text(c);
                
                // Append the years
                for (y=0; y<31; y++) {
                    var countryYears = countryGroup.append('rect')
                        .attr('x', 150+15*y)
                        .attr('y', 60+35*counter)
                        .attr('width', '10px')
                        .attr('height', '10px')
                        .attr('fill', function(d) {
                        
                            var yr = 1896+y*4;
                        
                            // If country won an award that year
                            if (data[c].byyear[yr]) {
                                
                                // If country won more than one award that year
//                                var n = data[c].byyear[yr].t;
//                                console.log(n);
//                                for (z=0; z<n; z++) {
//                                    countryYears.append('rect')
//                                        .attr('x', 150+15*y)
//                                        .attr('y', 60+50*counter - z*15)
//                                        .attr('width', '10px')
//                                        .attr('height', '10px')
//                                        .attr('fill', 'salmon');
//                                        // .style('display', 'none');
//                                } 
                                
                                return 'salmon';
                            } else {
                                return 'lightgray';
                            }
                        })
                        .on('mouseenter', function(d) {
                            // console.log(d);
                        });
                    
                // Hover over the years
                // yrs.on('mouseenter', function(d) {
                    // console.log('mouseeenter');
                    // console.log(d);
                    
                    // d3.select('#'+c+'squares').style('display', 'inline');
                //});
                    
                }
                counter += 1;
            
            }
            
            // On hover
//            d3.selectAll(countryGroup)
//                .on('click', function(d) {
//                console.log('hover');
//            })
        }
        
        
        
    </script>
    
    
    <div class = "diagrams">

    
    <div id='plotCountries'></div>
    
    <script>
        
        var yearScale = d3.scaleLinear().domain([1896,2016]).range([300,800]);
        
        // Create top axis 
        
        var graphAxis = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 60);
        
        var gAxis = d3.axisTop(yearScale)
        .ticks(10)
        .tickSize(2);
        
        graphAxis.append("line")
        .attr("x1", yearScale(1896)).attr("y1", 45)
        .attr("x2", yearScale(2016)+20).attr("y2", 45)
        .attr("stroke-width", .2).attr("stroke", "grey");
        
        for (y = 1896; y < 2017; y = y + 8){
            graphAxis.append("text").text(y)
            .attr("class", "graphAxis")
            .attr("x", yearScale(y)).attr("y", 35)
            .style("text-anchor", "right")
            .style("font-size", 12)
            .attr("fill", "grey");   
            
        }
                
        // Create svg group for each sport
        
        var longJump_svg = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 50);
        var hammerThrow_svg = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 50);
        var freestyle_svg = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 50);
        var hurdles_svg = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 50);
        var shotPut_svg = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 50);
        var tripleJump_svg = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 50);
        var track_svg = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 50);
        var butterfly_svg = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 50);
        var discusThrow_svg = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 50);
        var highJump_svg = d3.select('.diagrams').append("svg")
        .attr("width", 1400).attr("height", 50);
        
        
        var olympicYears = [];
        for (i = 1896; i < 2017; i = i + 4) {
            olympicYears.push(i)
        }
                
        function plotChart(data, svgGroup,sportImage, measure,progress, color) {
            
            var sportData = [];
            
            var yearData = [];
            
            var counter = 0;
            
            for (year in data) {
                
                if (data[year].game == "200m Butterfly Mens" || data[year].game == "200m Butterfly Womens" || data[year].game == "400m Freestyle Mens" || data[year].game == "400m Freestyle Womens") {
                    
                var result= data[year].result;
                    
                var seconds = Number(result.substr(0,1))*60 + Number(result.substr(2,3))
                    
                sportData.push(seconds)
                }
                
                else { sportData.push(Number(data[year].result))}
                
                
                yearData.push(Number(year));
                
            }
            

            var min = d3.min(sportData)-1;
            var max = d3.max(sportData);
            
            var resultScale = d3.scaleLinear().domain([min,max]).range([50,0]);
        
    
            
            // Append the country names
            var sportName = svgGroup.append('text').text(data["2016"].game)
                    .attr('class', 'hover-sport')
                    .attr('x', 80)
                    .attr('y', 30);
            
            
            var sportImage = svgGroup.append('image')
                    .attr("xlink:href", sportImage)
                    .attr('x', 25)
                    .attr('y', 15)
                    .attr("width", 30);    
            
            // Append the years
            for (y in olympicYears) {
                    var sportYears = svgGroup.selectAll("g").data(olympicYears)
                        .enter().append("rect")
                        .attr("class", "dataPoints")
                        .attr('x', function(d) {return yearScale(d)})
                        .attr('y', 20)
                        .attr('width', '15px')
                        .attr('height', '15px')
                        .attr('fill', function(d) {
                        
                            // If country won an award that year
                            if (yearData.includes(d)) {
                                return color;
                            } else {
                                return "#F0F3F4";
                            }
                            
                        })
                    .attr('stroke', function(d) {
                        
                            // If country won an award that year
                            if (yearData.includes(d)) {
                                return "none";
                            } else {
                                return "#F0F3F4";
                            }
                            
                        });
        
            svgGroup.append("rect").attr("class", "back").attr("x", yearScale(1896)).attr("y", 20).attr("width", 515).attr("height", 0).attr("fill", "#F0F3F4");
                
            svgGroup.on('mouseenter', function(d) {
                
                // Rescale
                resultScale.range([180,20])
                // Reshape bar charts
                svgGroup.selectAll(".dataPoints")
               .attr("height", function(d,i){
                    if (yearData.includes(d)){
                        var ind = yearData.indexOf(d);
                        return(180-resultScale(sportData[ind]))
                        }
                    })
                .transition().duration(1000)
                .attr("y", function(d,i){
                    if (yearData.includes(d)){
                        var ind = yearData.indexOf(d);
                        return(resultScale(sportData[ind]))
                    }
                    })
                .style("opacity", function(d,i){
                    if (yearData.includes(d)){
                        return 1;
                    }
                    else{ return 0}
                    });
                // Enlarge svg
                svgGroup.transition().duration(1000).attr("height", 200);
                
                svgGroup.select(".back").transition().attr("height", 160).style("opacity", 1);
                // Change text
                svgGroup.select(".hover-sport")
                .attr("fill", color)
                .style("font-weight", 600);
                svgGroup.append("text").attr("class", "groupText")
                .attr("x", 80).attr("y", 50)
                .text(measure).attr("fill", color);
                
                // Add percent change metric
        
                var firstResult = sportData[0];
                var firstYear = yearData[0];

                var currentResult = sportData[sportData.length-1]
                
                var percentChange = ((currentResult-firstResult)/firstResult) * 100;
                percentChange = Math.abs(Math.round(percentChange*100)/100);
                
                svgGroup.append("text").attr("class","groupText")
                .attr("x", 80).attr("y", 100)
                .text(percentChange + " %")
                .style("font-size", 20);
                
                 svgGroup.append("text").attr("class","groupText")
                .attr("x", 80).attr("y", 120)
                .text(progress + " since " + firstYear)
                .style("font-size", 16);
                
                // Add y axis
                
                var yAxis = d3.axisLeft(resultScale)
                .ticks(6)
                .tickSize(0);
                var axisGroup = svgGroup.append("g")
                .attr("class", "axis")
                .call(yAxis)
                .attr("fill", "blue")
                .style("font-size", 10)
                .attr("transform", "translate(280,0)");
                 });
                
                
                svgGroup.on('mouseleave', function(d) {
                    
                    // Change scale back
                    
                    resultScale.range([50,0])
                    
                    // Reshape SVG
                    svgGroup.transition().duration(1000)
                        .attr("height", 50);
                    
                    svgGroup.select(".back").transition().duration(500)
                        .attr("height", 0).style("opacity", 0);
                    
                    // Reshape bar charts
                    svgGroup.selectAll(".dataPoints")                            
                    .transition().duration(500)
                    .attr("y", 20)
                    .style("opacity", 1)
                    .transition()
                    .attr("height", 15);
                    
                    // Remove elements
                    svgGroup.select(".axis").remove();
                    svgGroup.selectAll(".groupText").remove();
                    svgGroup.select(".hover-sport")
                    .style("font-weight", 200)
                    .attr("fill", "black");
                    
                });
                    
                }
            
                counter += 1;
            
            }
                    
    </script>
    
    </div>
    
    
</body>

</html>